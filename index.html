<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>PatuKrishi Pro</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --green:#2e8b57;
      --accent:#228b22;
      --muted:#6b6b6b;
      --card:#ffffff;
      --bg:#f4f9f4;
      --pill:#e9f7ed;
    }
    html { scroll-behavior: smooth; }
    body { font-family: "Arial",sans-serif; margin:0; padding:0; background:var(--bg); color:#222; }
    nav {
      background:var(--green);
      padding:0.9rem 1rem;
      color:#fff;
      display:flex;
      gap:1rem;
      justify-content:center;
      flex-wrap:wrap;
      position:sticky;
      top:0;
      z-index:1000;
    }
    nav a { color:#fff; text-decoration:none; font-weight:600; margin:0 6px; }
    header.site-head { text-align:center; padding:1.4rem 1rem; background:linear-gradient(0deg, rgba(46,139,87,0.98), rgba(46,139,87,0.9)); color:#fff; }
    header.site-head h1 { margin:0; font-size:1.6rem; }
    main { max-width:1100px; margin:1.2rem auto; padding:0 1rem; }
    section.card { background:var(--card); padding:1.2rem; border-radius:10px; box-shadow:0 6px 20px rgba(0,0,0,0.05); margin-bottom:1rem; }
    h2 { color:var(--green); margin-top:0; }
    .flex { display:flex; gap:1rem; align-items:center; flex-wrap:wrap; }
    select, input[type="text"], textarea, input[type="file"] { padding:10px; border-radius:8px; border:1px solid #ddd; font-size:14px; width:100%; box-sizing:border-box; }
    textarea { min-height:100px; resize:vertical; }
    button { background:var(--accent); color:#fff; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; font-weight:600; }
    button.ghost { background:#fff; color:var(--accent); border:1px solid var(--accent); }
    .muted { color:var(--muted); font-size:13px; }
    .grid-2 { display:grid; grid-template-columns:1fr 1fr; gap:1rem; }
    .wide { width:100%; }
    .pill { background:var(--pill); padding:8px 10px; border-radius:999px; display:inline-block; margin:4px 4px 0 0; }
    #results { white-space:pre-wrap; background:#fff; padding:12px; border-radius:8px; box-shadow:inset 0 0 0 1px #eee; min-height:60px; }
    img.preview { max-width:100%; border-radius:8px; display:block; margin-top:8px; }
    /* Lens UI */
    #lensContainer { display:block; padding-top:12px; }
    #camera-container { position:relative; width:100%; max-width:700px; margin:12px auto; border-radius:10px; overflow:hidden; background:#000; }
    video, canvas, img { width:100%; height:auto; display:block; }
    #controls { display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:center; margin-top:10px; }
    .small { padding:8px 10px; font-size:14px; }
    .note { font-size:13px; color:var(--muted); margin-top:6px; }
    footer { text-align:center; padding:14px 8px; color:var(--muted); font-size:13px; }
    @media(max-width:800px){
      .grid-2 { grid-template-columns:1fr; }
      nav { gap:6px; padding:0.6rem; }
    }
  </style>

  <!-- Tesseract.js v4 -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>

  <!-- ===== MANDI MODULE (scoped styles) ===== -->
  <style>
    /* Scoped to #mandiModule to avoid touching the rest of your site */
    #mandiModule * { box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    #mandiModule { background: linear-gradient(135deg, #f5f9f4 0%, #e3ede0 100%); color:#333; line-height:1.6; border-radius:12px; padding:16px; }
    #mandiModule .container { max-width: 100%; margin: 0 auto; }
    #mandiModule header { background: linear-gradient(to right, #2e7d32, #4caf50); color: white; padding: 1.2rem; border-radius: 12px; margin-bottom: 1.2rem; text-align: center; }
    #mandiModule h1 { font-size: 1.8rem; margin-bottom: 0.25rem; }
    #mandiModule .subtitle { font-size: 1rem; opacity: 0.9; }
    #mandiModule .mandi-prices-section { background-color: white; border-radius: 12px; padding: 1.2rem; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08); margin-bottom: 1rem; }
    #mandiModule .section-title { color: #2e7d32; text-align: center; margin-bottom: 1rem; font-size: 1.4rem; position: relative; padding-bottom:6px; }
    #mandiModule .section-title::after { content: ''; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 80px; height: 4px; background-color: #4caf50; border-radius: 2px; }
    #mandiModule .selection-container { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px; }
    #mandiModule .input-group { display:flex; flex-direction:column; }
    #mandiModule .input-group label { font-weight: 600; margin-bottom: 6px; color: #555; }
    #mandiModule .input-group select { padding: 12px 14px; border: 1px solid #ddd; border-radius: 8px; font-size: 15px; background-color: #f9f9f9; }
    #mandiModule .fetch-btn { grid-column: 1 / -1; padding: 14px; background: linear-gradient(to right, #4caf50, #2e7d32); color: white; border: none; border-radius: 8px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
    #mandiModule .fetch-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15); }
    #mandiModule .fetch-btn:disabled { background: #ccc; cursor: not-allowed; }
    #mandiModule .results-container { margin-top: 16px; }
    #mandiModule .results-title { font-size: 1.2rem; color: #2e7d32; margin-bottom: 10px; border-bottom: 2px solid #e0e0e0; padding-bottom: 6px; }
    #mandiModule .mandi-cards { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px; }
    #mandiModule .mandi-card { background: linear-gradient(to bottom, #ffffff, #f1f8e9); border-radius: 12px; padding: 16px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); border-left: 5px solid #4caf50; transition: all 0.3s; }
    #mandiModule .mandi-card:hover { transform: translateY(-5px); box-shadow: 0 8px 16px rgba(0,0,0,0.15); }
    #mandiModule .mandi-name { font-size: 1.1rem; font-weight: 700; color: #2e7d32; margin-bottom: 6px; }
    #mandiModule .mandi-location { color: #666; margin-bottom: 10px; font-size: 0.95rem; }
    #mandiModule .price-list { list-style: none; margin-top: 10px; padding-left:0; }
    #mandiModule .price-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px dashed #e0e0e0; }
    #mandiModule .price-item:last-child { border-bottom: none; }
    #mandiModule .commodity { font-weight: 500; }
    #mandiModule .price { font-weight: 700; color: #2e7d32; font-size: 1.05rem; }
    #mandiModule .last-updated { text-align: right; font-size: 0.85rem; color: #888; margin-top: 10px; }
    #mandiModule .no-results { text-align: center; padding: 24px 12px; color: #757575; font-style: italic; grid-column: 1 / -1; background-color: #f9f9f9; border-radius: 12px; border: 2px dashed #ddd; }
    #mandiModule .loading { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 24px; grid-column: 1 / -1; }
    #mandiModule .spinner { width: 40px; height: 40px; border: 5px solid #f3f3f3; border-top: 5px solid #4caf50; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 12px; }
    #mandiModule footer { text-align:center; margin-top:16px; color:#666; font-size:0.9rem; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    @media(max-width:768px){
      #mandiModule .selection-container { grid-template-columns:1fr; }
    }
  </style>
</head>
<body>
  <nav>
    <a href="#home">Home</a>
    <a href="#crops">Crop Advisory</a>
    <a href="#weather">Weather</a>
    <a href="#krishi">Chatbot</a>
    <a href="#lens">Lens</a>
    <a href="#contact">Contact</a>
  </nav>

  <header class="site-head">
    <h1>üåæ PatuKrishi Pro ‚Äî Ideas & Innovations for Indian Farmers</h1>
  </header>

  <main>
    <!-- HOME / INTRO -->
    <section id="home" class="card">
      <h2>Welcome to PatuKrishi Pro</h2>
      <p class="muted">Welcome to PatuKrishi Pro ‚Äì Your all-in-one farming guide.</p>
      <p><strong>PatuKrishi</strong> is an innovative agricultural technology solution designed to empower farmers by providing precise and timely information crucial for successful farming. This smart product helps farmers determine the optimal cropping season for specific crops based on their region, ensuring better yields and reduced risks.</p>
      <p>Beyond just cropping advice, PatuKrishi integrates advanced climate forecasting and precipitation prediction, allowing farmers to plan their activities around weather patterns effectively. One of its standout features is the ability to analyze soil fertility simply by capturing a photo, leveraging AI-driven image recognition to give instant, accurate feedback about soil health.</p>
      <p>Complementing these features, PatuKrishi includes an intelligent AI assistant (in the Pro version) that responds to farmers‚Äô questions in real-time, offering expert guidance on a wide range of agricultural topics in regional languages.</p>
      <p>The product is offered in two versions: the standard PatuKrishi with essential features at an affordable price, and PatuKrishi Pro, which includes the full suite of AI capabilities for enhanced support.</p>
      <p>With a three-year guarantee and free technical support, PatuKrishi is committed to making modern agricultural innovations accessible and reliable, ultimately helping farmers increase productivity, reduce uncertainty, and achieve sustainable growth.</p>
      <p><strong>Tagline:</strong> ‚ÄúIdeas for Farmers, Innovating Farming‚Äù ‚Äî blending technology with traditional farming wisdom to transform rural agriculture.</p>
      <hr/>
      <p><strong>‡§™‡§ü‡•Å‡§ï‡•É‡§∑‡§ø</strong> ‡§è‡§ï ‡§Ö‡§≠‡§ø‡§®‡§µ ‡§ï‡•É‡§∑‡§ø ‡§™‡•ç‡§∞‡•å‡§¶‡•ç‡§Ø‡•ã‡§ó‡§ø‡§ï‡•Ä ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§® ‡§π‡•à ‡§ú‡§ø‡§∏‡•á ‡§∏‡§´‡§≤ ‡§ñ‡•á‡§§‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§∏‡§ü‡•Ä‡§ï ‡§î‡§∞ ‡§∏‡§Æ‡§Ø ‡§™‡§∞ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§∞‡§ï‡•á ‡§ï‡§ø‡§∏‡§æ‡§®‡•ã‡§Ç ‡§ï‡•ã ‡§∏‡§∂‡§ï‡•ç‡§§ ‡§¨‡§®‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§°‡§ø‡§ú‡§º‡§æ‡§á‡§® ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§</p>
      <p>‡§Ø‡§π ‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§ï‡§ø‡§∏‡§æ‡§®‡•ã‡§Ç ‡§ï‡•ã ‡§â‡§®‡§ï‡•á ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ ‡§ï‡•á ‡§Ü‡§ß‡§æ‡§∞ ‡§™‡§∞ ‡§µ‡§ø‡§∂‡§ø‡§∑‡•ç‡§ü ‡§´‡§∏‡§≤‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§á‡§∑‡•ç‡§ü‡§§‡§Æ ‡§´‡§∏‡§≤ ‡§Æ‡•å‡§∏‡§Æ ‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§Æ‡§¶‡§¶ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à, ‡§ú‡§ø‡§∏‡§∏‡•á ‡§¨‡•á‡§π‡§§‡§∞ ‡§™‡•à‡§¶‡§æ‡§µ‡§æ‡§∞ ‡§î‡§∞ ‡§ï‡§Æ ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§∏‡•Å‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§π‡•ã‡§§‡§æ ‡§π‡•à‡•§</p>
      <p>‡§™‡§ü‡•Å‡§ï‡•É‡§∑‡§ø ‡§â‡§®‡•ç‡§®‡§§ ‡§ú‡§≤‡§µ‡§æ‡§Ø‡•Å ‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§®‡•Å‡§Æ‡§æ‡§® ‡§î‡§∞ ‡§µ‡§∞‡•ç‡§∑‡§æ ‡§ï‡•Ä ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø‡§µ‡§æ‡§£‡•Ä ‡§ï‡•ã ‡§è‡§ï‡•Ä‡§ï‡•É‡§§ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à, ‡§ú‡§ø‡§∏‡§∏‡•á ‡§ï‡§ø‡§∏‡§æ‡§® ‡§Æ‡•å‡§∏‡§Æ ‡§ï‡•á ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§Ö‡§™‡§®‡•Ä ‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•Ä ‡§™‡•ç‡§∞‡§≠‡§æ‡§µ‡•Ä ‡§¢‡§Ç‡§ó ‡§∏‡•á ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§¨‡§®‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§</p>
      <p>‡§è‡§ï ‡§™‡•ç‡§∞‡§Æ‡•Å‡§ñ ‡§µ‡§ø‡§∂‡•á‡§∑‡§§‡§æ ‡§ï‡•á‡§µ‡§≤ ‡§è‡§ï ‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞ ‡§ñ‡•Ä‡§Ç‡§ö‡§ï‡§∞ ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§ï‡•Ä ‡§â‡§∞‡•ç‡§µ‡§∞‡§§‡§æ ‡§ï‡§æ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§π‡•à, ‡§ú‡•ã ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§ï‡•á ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§§‡§§‡•ç‡§ï‡§æ‡§≤, ‡§∏‡§ü‡•Ä‡§ï ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§¶‡•á‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§Ü‡§à-‡§∏‡§Ç‡§ö‡§æ‡§≤‡§ø‡§§ ‡§õ‡§µ‡§ø ‡§™‡§π‡§ö‡§æ‡§® ‡§ï‡§æ ‡§≤‡§æ‡§≠ ‡§â‡§†‡§æ‡§§‡•Ä ‡§π‡•à‡•§</p>
      <p>‡§™‡§ü‡•Å‡§ï‡•É‡§∑‡§ø ‡§Æ‡•á‡§Ç ‡§è‡§ï ‡§¨‡•Å‡§¶‡•ç‡§ß‡§ø‡§Æ‡§æ‡§® ‡§è‡§Ü‡§à ‡§∏‡§π‡§æ‡§Ø‡§ï (‡§™‡•ç‡§∞‡•ã ‡§∏‡§Ç‡§∏‡•ç‡§ï‡§∞‡§£ ‡§Æ‡•á‡§Ç) ‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§π‡•à ‡§ú‡•ã ‡§µ‡§æ‡§∏‡•ç‡§§‡§µ‡§ø‡§ï ‡§∏‡§Æ‡§Ø ‡§Æ‡•á‡§Ç ‡§ï‡§ø‡§∏‡§æ‡§®‡•ã‡§Ç ‡§ï‡•á ‡§∏‡§µ‡§æ‡§≤‡•ã‡§Ç ‡§ï‡§æ ‡§ú‡§µ‡§æ‡§¨ ‡§¶‡•á‡§§‡§æ ‡§π‡•à, ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞‡•Ä‡§Ø ‡§≠‡§æ‡§∑‡§æ‡§ì‡§Ç ‡§Æ‡•á‡§Ç ‡§ï‡•É‡§∑‡§ø ‡§µ‡§ø‡§∑‡§Ø‡•ã‡§Ç ‡§™‡§∞ ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û ‡§Æ‡§æ‡§∞‡•ç‡§ó‡§¶‡§∞‡•ç‡§∂‡§® ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§</p>
      <p>‡§Ø‡§π ‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§¶‡•ã ‡§∏‡§Ç‡§∏‡•ç‡§ï‡§∞‡§£‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§π‡•à: ‡§Æ‡§æ‡§®‡§ï ‡§™‡§ü‡•Å‡§ï‡•É‡§∑‡§ø ‡§ú‡§ø‡§∏‡§Æ‡•á‡§Ç ‡§ï‡§ø‡§´‡§æ‡§Ø‡§§‡•Ä ‡§Æ‡•Ç‡§≤‡•ç‡§Ø ‡§™‡§∞ ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§∏‡•Å‡§µ‡§ø‡§ß‡§æ‡§è‡§Å ‡§π‡•à‡§Ç, ‡§î‡§∞ ‡§™‡§ü‡•Å‡§ï‡•É‡§∑‡§ø ‡§™‡•ç‡§∞‡•ã, ‡§ú‡§ø‡§∏‡§Æ‡•á‡§Ç ‡§è‡§Ü‡§à ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§ì‡§Ç ‡§ï‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§∏‡•Ç‡§ü ‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§π‡•à‡•§</p>
      <p>‡§§‡•Ä‡§® ‡§∏‡§æ‡§≤ ‡§ï‡•Ä ‡§ó‡§æ‡§∞‡§Ç‡§ü‡•Ä ‡§î‡§∞ ‡§Æ‡•Å‡§´‡•ç‡§§ ‡§§‡§ï‡§®‡•Ä‡§ï‡•Ä ‡§∏‡§π‡§æ‡§Ø‡§§‡§æ ‡§ï‡•á ‡§∏‡§æ‡§•, ‡§™‡§ü‡•Å‡§ï‡•É‡§∑‡§ø ‡§Ü‡§ß‡•Å‡§®‡§ø‡§ï ‡§ï‡•É‡§∑‡§ø ‡§®‡§µ‡§æ‡§ö‡§æ‡§∞‡•ã‡§Ç ‡§ï‡•ã ‡§∏‡•Å‡§≤‡§≠ ‡§î‡§∞ ‡§µ‡§ø‡§∂‡•ç‡§µ‡§∏‡§®‡•Ä‡§Ø ‡§¨‡§®‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§™‡•ç‡§∞‡§§‡§ø‡§¨‡§¶‡•ç‡§ß ‡§π‡•à‡•§</p>
      <p><strong>‡§ü‡•à‡§ó‡§≤‡§æ‡§á‡§®:</strong> ‚Äú‡§Ü‡§á‡§°‡§ø‡§Ø‡§æ‡§ú‡§º ‡§´‡§º‡•â‡§∞ ‡§´‡§º‡§æ‡§∞‡•ç‡§Æ‡§∞‡•ç‡§∏, ‡§á‡§®‡•ã‡§µ‡•á‡§ü‡§ø‡§Ç‡§ó ‡§´‡§º‡§æ‡§∞‡•ç‡§Æ‡§ø‡§Ç‡§ó‚Äù ‚Äî ‡§™‡§æ‡§∞‡§Ç‡§™‡§∞‡§ø‡§ï ‡§ï‡•É‡§∑‡§ø ‡§ú‡•ç‡§û‡§æ‡§® ‡§ï‡•á ‡§∏‡§æ‡§• ‡§§‡§ï‡§®‡•Ä‡§ï ‡§ï‡§æ ‡§Æ‡§ø‡§∂‡•ç‡§∞‡§£ ‡§ï‡§∞ ‡§ó‡•ç‡§∞‡§æ‡§Æ‡•Ä‡§£ ‡§ï‡•É‡§∑‡§ø ‡§ï‡•ã ‡§¨‡§¶‡§≤‡§®‡•á ‡§ï‡§æ ‡§Æ‡§ø‡§∂‡§®‡•§.</p>
    </section>

    <!-- CROP ADVISORY -->
    <section id="crops" class="card">
      <h2>Crop Advisory</h2>
      <div class="grid-2">
        <div>
          <label>Select State</label>
          <select id="stateSelect" onchange="updateCropInfoBySeason()">
            <option value="">-- Select State --</option>
            <option>Andhra Pradesh</option><option>Arunachal Pradesh</option><option>Assam</option><option>Bihar</option>
            <option>Chhattisgarh</option><option>Goa</option><option>Gujarat</option><option>Haryana</option>
            <option>Himachal Pradesh</option><option>Jharkhand</option><option>Karnataka</option><option>Kerala</option>
            <option>Madhya Pradesh</option><option>Maharashtra</option><option>Manipur</option><option>Meghalaya</option>
            <option>Mizoram</option><option>Nagaland</option><option>Odisha</option><option>Punjab</option>
            <option>Rajasthan</option><option>Sikkim</option><option>Tamil Nadu</option><option>Telangana</option>
            <option>Tripura</option><option>Uttar Pradesh</option><option>Uttarakhand</option><option>West Bengal</option>
          </select>
        </div>
        <div>
          <label>Select Season</label>
          <select id="seasonSelect" onchange="updateCropInfoBySeason()">
            <option value="">-- Select Season --</option>
            <option value="Rabi">Rabi</option>
            <option value="Kharif">Kharif</option>
            <option value="Zaid">Zaid</option>
          </select>
        </div>
      </div>
      <div id="cropOutput" style="margin-top:12px;"></div>
    </section>

    <!-- SOIL FERTILITY MOCK -->
    <section id="fertility" class="card">
      <h2>üß™ Soil Fertility Check (Photo-Based Simulation)</h2>
      <p class="muted">Upload a soil photo and get a mock fertility estimate.</p>
      <input accept="image/*" id="soilPhotoInput" type="file" onchange="previewSoilImage()" />
      <div id="previewSoil"></div>
      <div style="margin-top:10px;">
        <button onclick="mockFertilityResult()">Check Fertility</button>
        <span id="fertilityResult" style="margin-left:12px; font-weight:600;"></span>
      </div>
    </section>

    <!-- ====== MANDI PRICES (Mock) ‚Äî added right after Soil Fertility ====== -->
    <section id="mandi" class="card">
      <h2>üíπ Mandi Prices</h2>
      <div id="mandiModule" class="container">
        <header>
          <h1>PatuKrishi - Mandi Prices</h1>
          <p class="subtitle">Agricultural Market Prices Solution</p>
        </header>

        <div class="mandi-prices-section">
          <h2 class="section-title">Find Mandi Prices ( Mock )</h2>

          <div class="selection-container">
            <!-- State -->
            <div class="input-group">
              <label for="mp-stateSelect">Select State:</label>
              <select id="mp-stateSelect">
                <option value="">-- Select your state --</option>
                <option value="Andhra Pradesh">Andhra Pradesh</option>
                <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                <option value="Assam">Assam</option>
                <option value="Bihar">Bihar</option>
                <option value="Chhattisgarh">Chhattisgarh</option>
                <option value="Goa">Goa</option>
                <option value="Gujarat">Gujarat</option>
                <option value="Haryana">Haryana</option>
                <option value="Himachal Pradesh">Himachal Pradesh</option>
                <option value="Jharkhand">Jharkhand</option>
                <option value="Karnataka">Karnataka</option>
                <option value="Kerala">Kerala</option>
                <option value="Madhya Pradesh">Madhya Pradesh</option>
                <option value="Maharashtra">Maharashtra</option>
                <option value="Manipur">Manipur</option>
                <option value="Meghalaya">Meghalaya</option>
                <option value="Mizoram">Mizoram</option>
                <option value="Nagaland">Nagaland</option>
                <option value="Odisha">Odisha</option>
                <option value="Punjab">Punjab</option>
                <option value="Rajasthan">Rajasthan</option>
                <option value="Sikkim">Sikkim</option>
                <option value="Tamil Nadu">Tamil Nadu</option>
                <option value="Telangana">Telangana</option>
                <option value="Tripura">Tripura</option>
                <option value="Uttar Pradesh">Uttar Pradesh</option>
                <option value="Uttarakhand">Uttarakhand</option>
                <option value="West Bengal">West Bengal</option>
              </select>
            </div>

            <!-- District -->
            <div class="input-group">
              <label for="mp-districtSelect">Select District:</label>
              <select id="mp-districtSelect" disabled>
                <option value="">-- Please select state first --</option>
              </select>
            </div>

            <!-- Crop Filter -->
            <div class="input-group">
              <label for="mp-commoditySelect">Filter by Crop:</label>
              <select id="mp-commoditySelect">
                <option value="">All Crops</option>
                <option value="wheat">Wheat</option>
                <option value="rice">Rice</option>
                <option value="tomato">Tomato</option>
                <option value="potato">Potato</option>
                <option value="onion">Onion</option>
                <option value="cotton">Cotton</option>
                <option value="maize">Maize</option>
                <option value="sugarcane">Sugarcane</option>
                <option value="soybean">Soybean</option>
                <option value="mustard">Mustard</option>
                <option value="barley">Barley</option>
                <option value="millet">Millet</option>
                <option value="groundnut">Groundnut</option>
                <option value="pulses">Pulses</option>
                <option value="chili">Chili</option>
                <option value="cabbage">Cabbage</option>
                <option value="cauliflower">Cauliflower</option>
                <option value="brinjal">Brinjal</option>
                <option value="cucumber">Cucumber</option>
                <option value="banana">Banana</option>
                <option value="mango">Mango</option>
                <option value="apple">Apple</option>
                <option value="grapes">Grapes</option>
                <option value="orange">Orange</option>
                <option value="pineapple">Pineapple</option>
                <option value="guava">Guava</option>
                <option value="watermelon">Watermelon</option>
                <option value="muskmelon">Muskmelon</option>
                <option value="lemon">Lemon</option>
                <option value="papaya">Papaya</option>
              </select>
            </div>
          </div>

          <button class="fetch-btn" id="mp-fetchPricesBtn" disabled>Get Mandi Prices</button>

          <div class="results-container">
            <h3 class="results-title">Current Market Prices</h3>
            <div class="mandi-cards" id="mp-mandiCards">
              <div class="no-results">
                <p>Select your state and district to view mandi prices</p>
              </div>
            </div>
          </div>
        </div>
    </section>
    <!-- ====== /MANDI PRICES ====== -->

    <!-- WEATHER -->
    <section id="weather" class="card">
      <h2>üå¶Ô∏è India Weather Finder</h2>
      <div class="flex" style="gap:0.6rem;">
        <input id="cityInput" type="text" placeholder="Enter city or village (India)" />
        <button onclick="getWeatherByCity()">Search</button>
        <button onclick="getWeatherByLocation()">üìç Use My Location</button>
      </div>
      <div id="result" style="margin-top:12px;"></div>
    </section>

   <!-- KRISHI BOT (Chatbot section) -->
    <section id="krishi" class="card">
      <h2>üåæ Krishi Bot</h2>
<div id="chatbox" style="border:1px solid #eee; padding:10px; border-radius:8px; min-height:200px; background:#fff;">
</div>
<!-- Chatbox UI -->
<div id="inputArea" style="display:flex; gap:8px; margin-top:10px; align-items:center;">
  <input type="text" id="userInput" placeholder="Type a message..." />
  <button id="sendBtn">Send</button>
  <button id="micBtn" title="Speak">üé§</button>
</div>

    <!-- LENS OCR + TRANSLATE (separate section) -->
    <section id="lens" class="card">
      <h2>üì∑ PatuKrishi Lens ‚Äî OCR + Translate (All Indian Languages)</h2>
      <p class="muted">Upload/capture an image, run OCR with the correct OCR languages, then choose an Indian language from the dropdown and click <strong>Translate</strong>.</p>

      <!-- Preview / Camera -->
      <div id="camera-container" style="display:none; margin-bottom:12px;">
        <video id="video" autoplay playsinline style="background:#000;"></video>
        <canvas id="overlay" style="display:none;"></canvas>
        <img id="uploadedImage" class="preview" style="display:none;" alt="uploaded image preview" />
      </div>

      <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
        <input id="imageInput" type="file" accept="image/*" />
        <button onclick="startCamera()" class="small">Start Camera</button>
        <button onclick="captureFromCamera()" class="small">Capture</button>
        <button onclick="loadImageFromInput()" class="small">Load Image</button>
      </div>

      <div id="controls" style="margin-top:10px;">
        <div style="min-width:220px;">
          <label class="muted">OCR languages (choose one or more)</label>
          <select id="ocrLangSelect" multiple style="min-width:220px; height:130px;"></select>
          <div class="note">Tip: select languages that match the script in the image (e.g., Hindi for Devanagari).</div>
        </div>

        <div style="min-width:220px;">
          <label class="muted">Translate To (choose one)</label>
          <select id="transTarget" style="min-width:220px; height:130px;"></select>
          <div class="note">After OCR: click <strong>Run OCR</strong>, then <strong>Translate</strong>.</div>
        </div>
      </div>

      <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap;">
        <button onclick="runOCRNow()">Run OCR</button>
        <button onclick="translateExtracted()" class="ghost">Translate</button>
        <button onclick="clearLens()" class="small ghost">Clear</button>
      </div>

      <div id="results" style="margin-top:12px;"></div>
      <textarea id="extractedText" placeholder="Extracted text will appear here..." style="margin-top:10px; width:100%;"></textarea>
      <div id="translatedBox" style="margin-top:12px;"></div>
    </section>

    <!-- CONTACT -->
    <section id="contact" class="card">
      <h2>Contact</h2>
      <p><strong>Phone:</strong> +91 98*** *****</p>
      <p><strong>Email:</strong> chanakyasahni8@gmail.com</p>
      <div class="muted">This Website is owned by Team - The Synergistic Trio</div>
      <div class="muted">New updates very soon...</div>
    </section>
  </main>

  <footer>¬© PatuKrishi-Pro-</footer>

  <script>
    /* ------------------ Crop Data ------------------ */
    const cropData = {
      "Punjab": { "Rabi": "Wheat, Mustard, Barley", "Kharif": "Paddy, Cotton, Maize", "Zaid": "Moong, Watermelon, Cucumber" },
      "Rajasthan": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Bajra, Jowar, Moong", "Zaid": "Watermelon, Pumpkin, Cucumber" },
      "Maharashtra": { "Rabi": "Wheat, Chickpea, Safflower", "Kharif": "Cotton, Soybean, Tur", "Zaid": "Groundnut, Vegetables, Sunflower" },
      "Tamil Nadu": { "Rabi": "Maize, Sorghum, Pulses", "Kharif": "Rice, Sugarcane, Cotton", "Zaid": "Vegetables, Fruits, Green Gram" },
      "Uttar Pradesh": { "Rabi": "Wheat, Barley, Peas", "Kharif": "Rice, Maize, Arhar", "Zaid": "Cucumber, Moong, Pumpkin" },
      "West Bengal": { "Rabi": "Wheat, Mustard, Lentil", "Kharif": "Rice, Jute, Maize", "Zaid": "Green Gram, Vegetables, Fruits" },
      "Andhra Pradesh": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Arunachal Pradesh": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Assam": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Bihar": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Chhattisgarh": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Goa": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Gujarat": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Haryana": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Himachal Pradesh": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Jharkhand": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Karnataka": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Kerala": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Madhya Pradesh": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Manipur": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Meghalaya": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Mizoram": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Nagaland": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Odisha": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Sikkim": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Telangana": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Tripura": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Uttarakhand": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" }
    };

    function updateCropInfoBySeason(){
      const state = document.getElementById('stateSelect').value;
      const season = document.getElementById('seasonSelect').value;
      const out = document.getElementById('cropOutput');
      if (cropData[state] && cropData[state][season]) {
        out.innerHTML = `<div class="pill"><strong>${season} Crops in ${state}:</strong> ${cropData[state][season]}</div>`;
      } else {
        out.innerHTML = `<p class="muted"><em>No data available for the selected combination.</em></p>`;
      }
    }

    /* ---------- Soil fertility mock ---------- */
    function previewSoilImage() {
      const input = document.getElementById("soilPhotoInput");
      const preview = document.getElementById("previewSoil");
      preview.innerHTML = "";
      if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const img = document.createElement("img");
          img.src = e.target.result;
          img.className = 'preview';
          preview.appendChild(img);
        };
        reader.readAsDataURL(input.files[0]);
      }
    }
    function mockFertilityResult(){
      const options = ["High","Medium","Low"];
      const res = options[Math.floor(Math.random()*options.length)];
      document.getElementById("fertilityResult").innerText = "Fertility Estimate: " + res;
    }

    /* ---------- Weather (OpenWeather) ---------- */
    const apiKey = "7ab4aad915c97e3f0a93de8e8d570956";
    async function getWeatherByCity(){
      const city = document.getElementById("cityInput").value.trim();
      const out = document.getElementById("result");
      if (!city) { out.innerHTML = "‚ö†Ô∏è Please enter a place name!"; return; }
      out.innerHTML = "Loading weather...";
      try {
        const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(city)},IN&appid=${apiKey}&units=metric`);
        const data = await response.json();
        if (data.cod !== 200) {
          out.innerHTML = `‚ö†Ô∏è "${city}" not found, try GPS or a nearby town.`;
        } else {
          out.innerHTML = `<b>üìç ${data.name}:</b> ${data.main.temp} ¬∞C ‚Äî ${data.weather[0].description} <br>Humidity: ${data.main.humidity}% ¬∑ Wind: ${data.wind.speed} m/s`;
        }
      } catch(e){ out.innerHTML = "‚ö†Ô∏è Weather error"; console.error(e); }
    }
    function getWeatherByLocation(){
      const out = document.getElementById("result");
      if (!navigator.geolocation) { out.innerHTML = "‚ö†Ô∏è Geolocation not supported."; return; }
      out.innerHTML = "Getting location...";
      navigator.geolocation.getCurrentPosition(async pos => {
        try {
          const lat = pos.coords.latitude, lon = pos.coords.longitude;
          const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric`);
          const data = await response.json();
          if (data.cod !== 200) out.innerHTML = `‚ùå ${data.message}`;
          else out.innerHTML = `<b>üìç ${data.name}:</b> ${data.main.temp} ¬∞C ‚Äî ${data.weather[0].description} <br>Humidity: ${data.main.humidity}% ¬∑ Wind: ${data.wind.speed} m/s`;
        } catch(e){ out.innerHTML = "‚ö†Ô∏è Weather error"; console.error(e); }
      }, ()=>{ out.innerHTML = "‚ö†Ô∏è Location access denied."; });
    }

    const chatbox = document.getElementById("chatbox");
    const userInput = document.getElementById("userInput");
    const sendBtn = document.getElementById("sendBtn");
    const micBtn = document.getElementById("micBtn");

    // Predefined answers for all Indian states (only in English for simplicity)
    const stateAnswers = {
      "andhra pradesh": "The current CM of Andhra Pradesh is Sri Nara Chandrababu Naidu.",
      "arunachal pradesh": "The current CM of Arunachal Pradesh is Shri Pema Khandu.",
      "assam": "The current CM of Assam is Shri Himanta Biswa Sarma.",
      "bihar": "The current CM of Bihar is Shri Nitish Kumar.",
      "chhattisgarh": "The current CM of Chhattisgarh is Shri Vishnu Deo Sai.",
      "delhi": "The current CM of Delhi(NCT) is Smt.Rekha Gupta.",
      "goa": "The current CM of Goa is Shri Pramod Sawant.",
      "gujarat": "The current CM of Gujarat is Shri Bhupendra Patel.",
      "haryana": "The current CM of Haryana is Shri Nayab Singh Saini.",
      "himachal pradesh": "The current CM of Himachal Pradesh is Shri Sukhvinder Singh Sukhu.",
      "jammu and kashmir": "Shri Omar Abdullah.",
      "jharkhand": "The current CM of Jharkhand is Shri Hemant Soren.",
      "karnataka": "The current CM of Karnataka is Shri Siddaramaiah.",
      "kerala": "The current CM of Kerala is Shri Pinarayi Vijayan.",
      "madhya pradesh": "The current CM of Madhya Pradesh is Shri Mohan Yadav.",
      "maharashtra": "The current CM of Maharashtra is Shri Davendra Fadnavis.",
      "manipur": "The current CM of Manipur is Shri N. Biren Singh.",
      "meghalaya": "The current CM of Meghalaya is Shri Conrad Kongkal Sangma.",
      "mizoram": "The current CM of Mizoram is Shri PU Lalduhoma.",
      "nagaland": "The current CM of Nagaland is Shri Neiphiu Rio.",
      "odisha": "The current CM of Odisha is Shri Mohan Charan Majhi.",
      "puducherry": "The current CM of Puducherry(UT) is Shri N. Rangaswamy.",
      "punjab": "The current CM of Punjab is Shri Bhagwant Mann.",
      "rajasthan": "The current CM of Rajasthan is Shri Bhajan Lal Sharma.",
      "sikkim": "The current CM of Sikkim is Shri Prem Singh Tamang.",
      "tamil nadu": "The current CM of Tamil Nadu is Shri M. K. Stalin.",
      "telangana": "The current CM of Telangana is Shri A. Revant Reddy.",
      "tripura": "The current CM of Tripura is Shri Manik Saha.",
      "uttar pradesh": "The current CM of Uttar Pradesh is Shri Yogi Adityanath.",
      "uttarakhand": "The current CM of Uttarakhand is Shri Pushkar Singh Dhami.",
      "west bengal": "The current CM of West Bengal is Smt. Mamata Banerjee."
    };

    // Function to add message to chat window
    function addMessage(text, sender) {
      const div = document.createElement("div");
      div.className = "message " + sender;
      div.innerText = text;
      chatbox.appendChild(div);
      chatbox.scrollTop = chatbox.scrollHeight;
    }

    // Text-to-speech function
    function speak(text, lang='en-US') {
      if ('speechSynthesis' in window) {
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = lang;
        window.speechSynthesis.speak(utterance);
      }
    }

    // Main response handler
    async function handleResponse(message) {
      const msgLower = message.toLowerCase().trim();

      // Check if message mentions a state
      for (const state in stateAnswers) {
        if (msgLower.includes(state)) {
          const answer = stateAnswers[state];
          addMessage(answer, "bot");
          // Speak the answer
          speak(answer, 'en-US');
          return;
        }
      }

      // For other questions, call API
      try {
        const response = await fetch(
          "https://cors-anywhere.herokuapp.com/https://api.cohere.ai/v1/chat",
          {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "Authorization": "Bearer F99eoHubtMVbLnLGJwQbeyx1VIVwJz8bLdQrvDjU"
            },
            body: JSON.stringify({ model: "command-r-plus", message: message })
          }
        );
        const data = await response.json();
        if (data && data.text) {
          const replyEn = data.text;
          // No Hindi translation here
          addMessage(replyEn, "bot");
          speak(replyEn, 'en-US');
        } else {
          addMessage("‚ö†Ô∏è No response from API.", "bot");
        }
      } catch (error) {
        addMessage("‚ùå Error: " + error.message, "bot");
      }
    }

    // Send message function
    async function sendMessage() {
      const message = userInput.value.trim();
      if (!message) return;
      addMessage(message, "user");
      userInput.value = "";
      await handleResponse(message);
    }

    document.getElementById("sendBtn").addEventListener("click", sendMessage);
    document.getElementById("userInput").addEventListener("keypress", function(e){
      if (e.key === "Enter") sendMessage();
    });

    // Microphone speech recognition
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (SpeechRecognition) {
      const recognition = new SpeechRecognition();
      recognition.lang = 'en-US'; // change to 'hi-IN' for Hindi
      recognition.continuous = false;
      recognition.interimResults = false;

      recognition.onstart = () => { micBtn.textContent = "üõë"; };
      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        userInput.value = transcript;
        sendMessage();
      };
      recognition.onerror = () => { alert("Error recognizing speech"); };
      recognition.onend = () => { micBtn.textContent = "üé§"; };

      document.getElementById("micBtn").addEventListener("click", () => {
        recognition.start();
      });
    } else {
      document.getElementById("micBtn").disabled = true;
      document.getElementById("micBtn").title = "Speech recognition not supported";
    }
  
    /* ---------- LENS OCR + Translate ---------- */

    // Populate OCR languages and translate target list (all Indian + fallback)
    const ocrLangs = [
      {code:"eng", name:"English"},
      {code:"hin", name:"Hindi (‡§π‡§ø‡§®‡•ç‡§¶‡•Ä)"},
      {code:"ben", name:"Bengali (‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ)"},
      {code:"tam", name:"Tamil (‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç)"},
      {code:"tel", name:"Telugu (‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å)"},
      {code:"kan", name:"Kannada (‡≤ï‡≤®‡≥ç‡≤®‡≤°)"},
      {code:"mal", name:"Malayalam (‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç)"},
      {code:"ori", name:"Odia (‡¨ì‡¨°‡¨º‡¨ø‡¨Ü)"},
      {code:"guj", name:"Gujarati (‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä)"},
      {code:"mar", name:"Marathi (‡§Æ‡§∞‡§æ‡§†‡•Ä)"},
      {code:"pan", name:"Punjabi (‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä)"},
      {code:"urd", name:"Urdu (ÿßÿ±ÿØŸà)"},
      {code:"asm", name:"Assamese (‡¶Ö‡¶∏‡¶Æ‡ßÄ‡¶Ø‡¶º‡¶æ)"},
      {code:"san", name:"Sanskrit (‡§∏‡§Ç‡§∏‡•ç‡§ï‡•É‡§§‡§Æ‡•ç)"},
      {code:"mai", name:"Maithili (‡§Æ‡•à‡§•‡§ø‡§≤‡•Ä)"},
      {code:"nep", name:"Nepali (‡§®‡•á‡§™‡§æ‡§≤‡•Ä)"}
    ];

    const translateTargets = [
      {code:"hi", name:"Hindi"},
      {code:"bn", name:"Bengali"},
      {code:"ta", name:"Tamil"},
      {code:"te", name:"Telugu"},
      {code:"kn", name:"Kannada"},
      {code:"ml", name:"Malayalam"},
      {code:"or", name:"Odia"},
      {code:"gu", name:"Gujarati"},
      {code:"mr", name:"Marathi"},
      {code:"pa", name:"Punjabi"},
      {code:"ur", name:"Urdu"},
      {code:"as", name:"Assamese"},
      {code:"sa", name:"Sanskrit"},
      {code:"mai", name:"Maithili"},
      {code:"ne", name:"Nepali"},
      {code:"sd", name:"Sindhi"},
      {code:"ks", name:"Kashmiri"},
      {code:"doi", name:"Dogri"},
      {code:"kok", name:"Konkani"},
      {code:"bho", name:"Bhojpuri"},
      {code:"mni", name:"Manipuri"},
      {code:"en", name:"English"},
      {code:"fr", name:"French"},
      {code:"es", name:"Spanish"}
    ];

    (function populateLangs(){
      const ocrSelect = document.getElementById('ocrLangSelect');
      ocrLangs.forEach(l=>{
        const opt = document.createElement('option');
        opt.value = l.code; opt.textContent = `${l.name} (${l.code})`;
        if (l.code==='eng' || l.code==='hin') opt.selected=true;
        ocrSelect.appendChild(opt);
      });

      const transSelect = document.getElementById('transTarget');
      translateTargets.forEach(t=>{
        const opt = document.createElement('option');
        opt.value = t.code; opt.textContent = t.name;
        if (t.code==='hi') opt.selected=true;
        transSelect.appendChild(opt);
      });
    })();

    /* ---------- Lens image handling & OCR ---------- */
    let _capturedImageDataURL = null;
    let _extractedText = "";

    async function startCamera(){
      const camContainer = document.getElementById('camera-container');
      const video = document.getElementById('video');
      const uploadedImage = document.getElementById('uploadedImage');
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
        video.srcObject = stream;
        camContainer.style.display = "block";
        uploadedImage.style.display = "none";
      } catch(e){
        alert("Camera not available or permission denied. Use image upload instead.");
        console.error(e);
      }
    }

    function captureFromCamera(){
      const video = document.getElementById('video');
      if (!video || !video.videoWidth) { alert("Start camera first."); return; }
      const canvas = document.getElementById('overlay');
      canvas.style.display = 'block';
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      _capturedImageDataURL = canvas.toDataURL('image/png');
      document.getElementById('results').innerText = "Image captured. Click Run OCR.";
      document.getElementById('uploadedImage').style.display = 'none';
    }

    function loadImageFromInput(){
      const f = document.getElementById('imageInput').files[0];
      if (!f) { alert("Choose an image file first."); return; }
      const url = URL.createObjectURL(f);
      const uploadedImage = document.getElementById('uploadedImage');
      uploadedImage.src = url;
      uploadedImage.style.display = 'block';
      document.getElementById('camera-container').style.display = 'block';
      const img = new Image();
      img.onload = function(){
        const canvas = document.getElementById('overlay');
        canvas.width = img.naturalWidth;
        canvas.height = img.naturalHeight;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(img,0,0);
        _capturedImageDataURL = canvas.toDataURL('image/png');
        document.getElementById('results').innerText = "Image loaded. Click Run OCR.";
      };
      img.src = url;
    }

    async function runOCRNow(){
      if (!_capturedImageDataURL) { alert("No captured/uploaded image. Use camera capture or load an image."); return; }
      const selectedOptions = Array.from(document.getElementById('ocrLangSelect').selectedOptions).map(o=>o.value);
      const langList = selectedOptions.length ? selectedOptions.join('+') : 'eng';
      document.getElementById('results').innerText = `Loading OCR model for ${langList}...`;

      try {
        const { data } = await Tesseract.recognize(
          _capturedImageDataURL,
          langList,
          {
            logger: m => {
              if (m.status && (m.progress !== undefined)) {
                document.getElementById('results').innerText = `${m.status} ‚Äî ${(m.progress*100).toFixed(0)}%`;
              }
            },
            langPath: "https://tessdata.projectnaptha.com/4.0.0"
          }
        );
        _extractedText = (data.text || "").trim();
        document.getElementById('extractedText').value = _extractedText || "(no text detected) ";
        document.getElementById('results').innerHTML = `<b>Extracted Text:</b><br>${_extractedText || "(empty)"}<br><span class="muted">Now choose a language and click Translate.</span>`;
      } catch(err){
        console.error(err);
        document.getElementById('results').innerText = "OCR error: see console.";
      }
    }

    async function translateExtracted(){
      const text = (document.getElementById('extractedText').value || "").trim();
      if (!text) { alert("No extracted text. Run OCR first."); return; }
      const target = document.getElementById('transTarget').value || 'hi';
      document.getElementById('translatedBox').innerHTML = "Translating...";
      try {
        const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=${encodeURIComponent(target)}&dt=t&q=${encodeURIComponent(text)}`;
        const res = await fetch(url);
        if (!res.ok) throw new Error('Translation endpoint failed');
        const data = await res.json();
        const translated = (data[0] || []).map(seg => seg[0]).join('');
        document.getElementById('translatedBox').innerHTML = `<div style="background:#fff;padding:12px;border-radius:8px;">${translated || "(no translation returned)"}</div>`;
      } catch(e){
        console.error(e);
        // fallback: MyMemory
        try {
          const mm = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=auto|${encodeURIComponent(target)}`);
          const mmdata = await mm.json();
          const txt = mmdata.responseData && mmdata.responseData.translatedText ? mmdata.responseData.translatedText : "(no translation)";
          document.getElementById('translatedBox').innerHTML = `<div style="background:#fff;padding:12px;border-radius:8px;">${txt}</div>`;
        } catch(e2){
          document.getElementById('translatedBox').innerHTML = `<div style="background:#fff;padding:12px;border-radius:8px;">Translation error. See console.</div>`;
        }
      }
    }

    function clearLens(){
      _capturedImageDataURL = null;
      _extractedText = "";
      document.getElementById('results').innerText = "";
      document.getElementById('extractedText').value = "";
      document.getElementById('translatedBox').innerHTML = "";
      document.getElementById('uploadedImage').src = "";
      document.getElementById('uploadedImage').style.display = 'none';
      const canvas = document.getElementById('overlay');
      if (canvas) { const ctx = canvas.getContext('2d'); ctx.clearRect(0,0,canvas.width,canvas.height); canvas.style.display='none'; }
    }

    // auto-load image input change to preview
    document.getElementById('imageInput').addEventListener('change', function(){
      const f = this.files[0];
      if (!f) return;
      const url = URL.createObjectURL(f);
      const imgEl = document.getElementById('uploadedImage');
      const camContainer = document.getElementById('camera-container');
      imgEl.src = url; imgEl.onload = function(){
        camContainer.style.display = 'block'; imgEl.style.display = 'block';
        const canvas = document.getElementById('overlay');
        const ctx = canvas.getContext('2d');
        canvas.width = imgEl.naturalWidth; canvas.height = imgEl.naturalHeight;
        ctx.drawImage(imgEl,0,0);
        _capturedImageDataURL = canvas.toDataURL('image/png');
        document.getElementById('results').innerText = "Image ready. Click Run OCR.";
      };
    });

    // expose functions for inline buttons
    window.runOCRNow = runOCRNow;
    window.translateExtracted = translateExtracted;
    window.startCamera = startCamera;
    window.captureFromCamera = captureFromCamera;
    window.loadImageFromInput = loadImageFromInput;
    window.clearLens = clearLens;

    /* ======= MANDI MODULE SCRIPT (scoped & namespaced) ======= */
    (function(){
      // All states and districts data
      const districtsByState = {
        "Andhra Pradesh": ["Anantapur", "Chittoor", "East Godavari", "Guntur", "Kadapa", "Krishna", "Kurnool", "Nellore", "Prakasam", "Srikakulam", "Visakhapatnam", "West Godavari", "YSR Kadapa"],
        "Arunachal Pradesh": ["Tawang", "West Kameng", "East Kameng", "Papum Pare", "Kurung Kumey", "Kra Daadi", "Lower Subansiri", "Upper Subansiri", "West Siang", "East Siang", "Siang", "Upper Siang", "Lower Siang", "Changlang", "Tirap", "Longding"],
        "Assam": ["Baksa", "Barpeta", "Bongaigaon", "Cachar", "Chirang", "Darrang", "Dhemaji", "Dhubri", "Dibrugarh", "Goalpara", "Golaghat", "Hailakandi", "Jorhat", "Kamrup", "Kamrup Metropolitan", "Karbi Anglong", "Karimganj", "Kokrajhar", "Lakhisarai", "Majuli", "Morigaon", "Nagaon", "Nalbari", "Sivasagar", "Sonitpur", "South Salmara-Mankachar", "Tinsukia", "Udalguri", "West Karbi Anglong"],
        "Bihar": ["Araria", "Arwal", "Aurangabad", "Banka", "Begusarai", "Bhagalpur", "Bhojpur", "Buxar", "Darbhanga", "East Champaran", "Gaya", "Gopalganj", "Jamui", "Jehanabad", "Kaimur", "Katihar", "Khagaria", "Kishanganj", "Lakhisarai", "Madhepura", "Madhubani", "Munger", "Muzaffarpur", "Nalanda", "Nawada", "Patna", "Purnia", "Rohtas", "Saharsa", "Samastipur", "Saran", "Sheikhpura", "Sheohar", "Sitamarhi", "Siwan", "Supaul", "Vaishali", "West Champaran"],
        "Chhattisgarh": ["Balod", "Baloda Bazar", "Balrampur", "Bastar", "Bemetara", "Bijapur", "Bilaspur", "Dantewada", "Dhamtari", "Durg", "Gariaband", "Janjgir-Champa", "Jashpur", "Kabirdham", "Kanker", "Korba", "Kondagaon", "Koriya", "Mahasamund", "Mungeli", "Narayanpur", "Raigarh", "Raipur", "Rajnandgaon", "Sukma", "Surajpur", "Surguja"],
        "Goa": ["North Goa", "South Goa"],
        "Gujarat": ["Ahmedabad", "Amreli", "Anand", "Aravalli", "Banaskantha", "Bharuch", "Bhavnagar", "Botad", "Chhota Udepur", "Dahod", "Dang", "Devbhoomi Dwarka", "Gandhinagar", "Gir Somnath", "Jamnagar", "Junagadh", "Kachchh", "Kheda", "Mahisagar", "Mehsana", "Morbi", "Narmada", "Navsari", "Panchmahal", "Patan", "Porbandar", "Rajkot", "Sabarkantha", "Surat", "Surendranagar", "Tapi", "Vadodara", "Valsad"],
        "Haryana": ["Ambala", "Bhiwani", "Charkhi Dadri", "Faridabad", "Fatehabad", "Gurugram", "Hisar", "Jhajjar", "Jind", "Kaithal", "Karnal", "Kurukshetra", "Mahendragarh", "Nuh", "Palwal", "Panchkula", "Pataudi", "Rewari", "Rohtak", "Sirsa", "Sonipat", "Yamunanagar"],
        "Himachal Pradesh": ["Bilaspur", "Chamba", "Hamirpur", "Kangra", "Kinnaur", "Kullu", "Lahaul and Spiti", "Mandi", "Shimla", "Sirmaur", "Solan", "Una"],
        "Jharkhand": ["Bokaro", "Chatra", "Deoghar", "Dhanbad", "Dumka", "East Singhbhum", "Garmah", "Giridih", "Godda", "Gumla", "Hazaribagh", "Jamtara", "Khunti", "Koderma", "Latehar", "Lohardaga", "Pakur", "Palamu", "Ramgarh", "Ranchi", "Sahibganj", "Seraikela Kharsawan", "Simdega", "West Singhbhum"],
        "Karnataka": ["Bagalkot", "Bangalore Rural", "Bangalore Urban", "Belagavi", "Bellary", "Bidar", "Chamarajanagar", "Chikkaballapur", "Chikkamagaluru", "Chitradurga", "Dakshina Kannada", "Davanagere", "Dharwad", "Gadag", "Hassan", "Haveri", "Kolar", "Koppal", "Mandya", "Mysuru", "Raichur", "Ramanagara", "Shivamogga", "Tumakuru", "Udupi", "Uttara Kannada", "Vijayapura", "Vijayanagara", "Yadgir"],
        "Kerala": ["Alappuzha", "Ernakulam", "Idukki", "Kottayam", "Kozhikode", "Malappuram", "Palakkad", "Pathanamthitta", "Thiruvananthapuram", "Thrissur", "Wayanad"],
        "Madhya Pradesh": ["Alirajpur", "Anuppur", "Ashoknagar", "Balaghat", "Barwani", "Betul", "Bhind", "Bhopal", "Burhanpur", "Chhatarpur", "Chhindwara", "Damoh", "Datia", "Dewas", "Dhar", "Dindori", "Guna", "Gwalior", "Harda", "Hoshangabad", "Indore", "Jabalpur", "Jhabua", "Katni", "Khandwa", "Khargone", "Mandla", "Mandsaur", "Morena", "Narsinghpur", "Neemuch", "Panna", "Raisen", "Rajgarh", "Ratlam", "Rewa", "Sagar", "Satna", "Sehore", "Seoni", "Shahdol", "Shajapur", "Sheopur", "Shivpuri", "Sidhi", "Singrauli", "Tikamgarh", "Ujjain", "Umaria", "Vidisha"],
        "Maharashtra": ["Ahmednagar", "Akola", "Amravati", "Aurangabad", "Beed", "Bhandara", "Buldhana", "Chandrapur", "Dhule", "Gadchiroli", "Gondia", "Hingoli", "Jalgaon", "Jalna", "Kolhapur", "Latur", "Mumbai City", "Mumbai Suburban", "Nagpur", "Nanded", "Nashik", "Osmanabad", "Palghar", "Parbhani", "Pune", "Raigad", "Ratnagiri", "Sangli", "Satara", "Sindhudurg", "Solapur", "Thane", "Wardha", "Washim", "Yavatmal"],
        "Manipur": ["Bishnupur", "Chandel", "Churachandpur", "Imphal East", "Imphal West", "Jiribam", "Kakching", "Kamjong", "Kangpokpi", "Noney", "Pherzawl", "Senapati", "Tamenglong", "Tengnoupal", "Thoubal", "Ukhrul"],
        "Meghalaya": ["East Garo Hills", "East Jaintia Hills", "East Khasi Hills", "North Garo Hills", "Ri Bhoi", "South Garo Hills", "South West Garo Hills", "South West Khasi Hills", "West Garo Hills", "West Jaintia Hills", "West Khasi Hills"],
        "Mizoram": ["Aizawl", "Champhai", "Kolasib", "Lawngtlai", "Lunglei", "Mamit", "Saiha", "Serchhip", "Hnahthial"],
        "Nagaland": ["Dimapur", "Kiphire", "Kohima", "Longleng", "Mokokchung", "Mon", "Peren", "Phek", "Tuensang", "Wokha", "Zunheboto"],
        "Odisha": ["Angul", "Balangir", "Balasore", "Bargarh", "Bhadrak", "Boudh", "Cuttack", "Deogarh", "Dhenkanal", "Gajapati", "Ganjam", "Jagatsinghpur", "Jajpur", "Jharsuguda", "Kalahandi", "Kandhamal", "Kendrapara", "Kendujhar", "Khordha", "Koraput", "Malkangiri", "Mayurbhanj", "Nabarangpur", "Nuapada", "Puri", "Rayagada", "Sambalpur", "Sonepur", "Sundergarh"],
        "Punjab": ["Amritsar", "Barnala", "Bathinda", "Fatehgarh Sahib", "Fazilka", "Firozpur", "Gurdaspur", "Hoshiarpur", "Jalandhar", "Kapurthala", "Ludhiana", "Mansa", "Moga", "Muktsar", "Pathankot", "Patiala", "Rupnagar", "Sangrur", "Shaheed Bhagat Singh Nagar", "Tarn Taran"],
        "Rajasthan": ["Ajmer", "Alwar", "Banswara", "Baran", "Barmer", "Bharatpur", "Bhilwara", "Bikaner", "Bundi", "Chittorgarh", "Churu", "Dausa", "Dholpur", "Dungarpur", "Hanumangarh", "Jaipur", "Jaisalmer", "Jalore", "Jhalawar", "Jhunjhunu", "Jodhpur", "Karauli", "Kota", "Nagaur", "Pali", "Pratapgarh", "Rajsamand", "Sawai Madhopur", "Sikar", "Sirohi", "Sri Ganganagar", "Tonk", "Udaipur"],
        "Sikkim": ["East Sikkim", "North Sikkim", "South Sikkim", "West Sikkim"],
        "Tamil Nadu": ["Ariyalur", "Chennai", "Coimbatore", "Cuddalore", "Dharmapuri", "Dindigul", "Erode", "Kanchipuram", "Kanyakumari", "Karur", "Krishnagiri", "Madurai", "Nagapattinam", "Namakkal", "Nilgiris", "Perambalur", "Pudukkottai", "Ramanathapuram", "Salem", "Sivaganga", "Tanjore", "Theni", "Thoothukudi", "Tiruchirappalli", "Tirunelveli", "Tiruppur", "Tiruvallur", "Tiruvannamalai", "Tiruvarur", "Vellore", "Viluppuram", "Virudhunagar"],
        "Telangana": ["Adilabad", "Bhadradri Kothagudem", "Hyderabad", "Jagtial", "Jangaon", "Jayashankar Bhupalpally", "Jogulamba Gadwal", "Kamareddy", "Karimnagar", "Khammam", "Kothagudem", "Mahabubabad", "Mahbubnagar", "Mancherial", "Medak", "Medchal-Malkajgiri", "Nagarkurnool", "Nalgonda", "Nirmal", "Nizamabad", "Peddapalli", "Rajanna Sircilla", "Rangareddy", "Sangareddy", "Siddipet", "Suryapet", "Vikarabad", "Wanaparthy", "Warangal Rural", "Warangal Urban", "Yadadri Bhuvanagiri"],
        "Tripura": ["Dhalai", "Gomati", "Khowai", "North Tripura", "Sepahijala", "South Tripura", "Unakoti", "West Tripura"],
        "Uttar Pradesh": ["Agra", "Aligarh", "Ambedkar Nagar", "Amethi", "Amroha", "Auraiya", "Ayodhya", "Azamgarh", "Baghpat", "Bahraich", "Ballia", "Balrampur", "Banda", "Barabanki", "Bareilly", "Basti", "Bhadohi", "Bijnor", "Budaun", "Bulandshahr", "Chandauli", "Chitrakoot", "Deoria", "Etah", "Etawah", "Farrukhabad", "Fatehpur", "Firozabad", "Gautam Buddha Nagar", "Gurugram", "Hapur", "Hardoi", "Hathras", "Jalaun", "Jaunpur", "Jhansi", "Kanshiram Nagar", "Kushinagar", "Lalitpur", "Lucknow", "Maharajganj", "Mahoba", "Mainpuri", "Mathura", "Mau", "Meerut", "Mirzapur", "Moradabad", "Muzaffarnagar", "Pilibhit", "Pratapgarh", "Rae Bareli", "Rampur", "Saharanpur", "Sambhal", "Siddharthnagar", "Sonbhadra", "Sultanpur", "Unnao", "Varanasi"],
        "Uttarakhand": ["Almora", "Bageshwar", "Chamoli", "Champawat", "Dehradun", "Haridwar", "Nainital", "Pauri Garhwal", "Pithoragarh", "Rudraprayag", "Tehri Garhwal", "Udham Singh Nagar", "Uttarkashi"],
        "West Bengal": ["Alipurduar", "Bankura", "Birbhum", "Cooch Behar", "Dooars", "Dhanbad", "Hooghly", "Howrah", "Jalpaiguri", "Jhargram", "Kalimpong", "Kolkata", "Malda", "Murshidabad", "Nadia", "North 24 Parganas", "Paschim Bardhaman", "Paschim Medinipur", "Purba Bardhaman", "Purba Medinipur", "Purulia", "South 24 Parganas", "Uttar Dinajpur"]
      };

      // elements
      const stateSelect = document.getElementById('mp-stateSelect');
      const districtSelect = document.getElementById('mp-districtSelect');
      const commoditySelect = document.getElementById('mp-commoditySelect');
      const fetchBtn = document.getElementById('mp-fetchPricesBtn');
      const mandiCards = document.getElementById('mp-mandiCards');

      document.addEventListener('DOMContentLoaded', () => {
        stateSelect.addEventListener('change', () => {
          const state = stateSelect.value;
          districtSelect.innerHTML = '<option value="">-- Select your district --</option>';
          if (state && districtsByState[state]) {
            districtsByState[state].forEach(d => {
              const option = document.createElement('option');
              option.value = d;
              option.textContent = d;
              districtSelect.appendChild(option);
            });
            districtSelect.disabled = false;
          } else {
            districtSelect.disabled = true;
          }
          fetchBtn.disabled = true;
        });

        districtSelect.addEventListener('change', () => {
          fetchBtn.disabled = !districtSelect.value;
        });

        fetchBtn.addEventListener('click', () => {
          const state = stateSelect.value;
          const district = districtSelect.value;
          const crop = commoditySelect.value;
          fetchMandiPrices(state, district, crop);
        });
      });

      // Mock data generator
      function generateMockData(state, district, crop, maxResults) {
        const cropOptions = [
          { name: 'Wheat', price: 2150, unit: 'quintal' },
          { name: 'Rice', price: 1890, unit: 'quintal' },
          { name: 'Tomato', price: 40, unit: 'kg' },
          { name: 'Potato', price: 25, unit: 'kg' },
          { name: 'Onion', price: 35, unit: 'kg' },
          { name: 'Cotton', price: 6500, unit: 'quintal' },
          { name: 'Maize', price: 1800, unit: 'quintal' },
          { name: 'Sugarcane', price: 320, unit: 'quintal' },
          { name: 'Soybean', price: 4200, unit: 'quintal' },
          { name: 'Mustard', price: 5200, unit: 'quintal' },
          { name: 'Barley', price: 1500, unit: 'quintal' },
          { name: 'Millet', price: 1600, unit: 'quintal' },
          { name: 'Groundnut', price: 4000, unit: 'quintal' },
          { name: 'Pulses', price: 5000, unit: 'quintal' },
          { name: 'Chili', price: 7500, unit: 'quintal' },
          { name: 'Cabbage', price: 15, unit: 'kg' },
          { name: 'Cauliflower', price: 20, unit: 'kg' },
          { name: 'Brinjal', price: 25, unit: 'kg' },
          { name: 'Cucumber', price: 18, unit: 'kg' },
          { name: 'Banana', price: 30, unit: 'dozen' },
          { name: 'Mango', price: 50, unit: 'kg' },
          { name: 'Apple', price: 120, unit: 'kg' },
          { name: 'Grapes', price: 80, unit: 'kg' },
          { name: 'Orange', price: 40, unit: 'kg' },
          { name: 'Pineapple', price: 35, unit: 'kg' },
          { name: 'Guava', price: 40, unit: 'kg' },
          { name: 'Watermelon', price: 20, unit: 'kg' },
          { name: 'Muskmelon', price: 25, unit: 'kg' },
          { name: 'Lemon', price: 15, unit: 'kg' },
          { name: 'Papaya', price: 30, unit: 'kg' }
        ];

        const filteredCrops = crop ? cropOptions.filter(c => c.name.toLowerCase() === crop.toLowerCase()) : cropOptions;

        const data = [];
        for (let i=0; i<maxResults; i++) {
          data.push({
            mandi: `${district} Market ${i+1}`,
            location: district,
            prices: filteredCrops.slice(0, Math.min(4, filteredCrops.length))
          });
        }
        return data;
      }

      function displayMandiPrices(data) {
        if (!data || data.length===0) {
          mandiCards.innerHTML = '<div class="no-results"><p>No data available</p></div>';
          return;
        }
        mandiCards.innerHTML = '';
        data.forEach(m => {
          const card = document.createElement('div');
          card.className = 'mandi-card';
          let pricesHTML = '';
          m.prices.forEach(p => {
            pricesHTML += `
              <li class="price-item">
                <span class="commodity">${p.name}</span>
                <span class="price">‚Çπ${p.price.toLocaleString('en-IN')} / ${p.unit}</span>
              </li>`;
          });
          card.innerHTML = `
            <h3 class="mandi-name">${m.mandi}</h3>
            <p class="mandi-location">${m.location}</p>
            <ul class="price-list">${pricesHTML}</ul>
            <p class="last-updated">Updated: ${new Date().toLocaleString()}</p>`;
          mandiCards.appendChild(card);
        });
      }

      async function fetchMandiPrices(state, district, crop) {
        mandiCards.innerHTML = `
          <div class="loading">
            <div class="spinner"></div>
            <p>Loading...</p>
          </div>`;
        await new Promise(r=>setTimeout(r,1200));
        const data = generateMockData(state, district, crop, 5);
        displayMandiPrices(data);
      }
    })();
    /* ======= /MANDI MODULE ======= */
  </script>
</body>
</html>
