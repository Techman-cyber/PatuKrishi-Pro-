<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>PatuKrishi-Pro</title>
<bg color: light green</>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html { scroll-behavior: smooth; }
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background:#f9fff9; }
    nav { background: #2e8b57; padding: 1rem; color: green; display: flex; gap: 2rem; justify-content: center; position: sticky; top: 0; z-index: 1000; }
    nav a { color: white; text-decoration: none; font-weight: bold; }
    section { padding: 3rem 2rem; max-width: 1000px; margin: auto; border-bottom: 1px solid #ccc; background:#fff; }
    h1,h2 { color: #2e8b57; margin-top: 0; }
    .intro-content p { line-height: 1.6; }
    .center { text-align: center; }
    /* Chatbot */
    #chatbox { width:100%; max-width:700px; height:420px; overflow-y:auto; border:1px solid #ccc; padding:10px; background:#fff; margin:0 auto; border-radius:8px; }
    #chatControls { text-align:center; margin-top:10px; }
    input[type=text] { width:70%; padding:10px; border:1px solid #ccc; border-radius:6px; }
    button { padding:10px 15px; margin:6px 5px; border:none; border-radius:6px; background:#2e8b57; color:#fff; cursor:pointer; }
    button:disabled { opacity:.6; cursor:not-allowed; }
    select { padding:10px; border-radius:6px; border:1px solid #ccc; }
    .quick-grid { display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:8px; max-width:700px; margin:10px auto 0; }
    .quick-grid button { width:100%; }
    /* Lens */
    #lensContainer { display:none; margin-top:20px; }
    #camera-container { position:relative; width:100%; max-width:700px; margin:20px auto; border-radius:8px; overflow:hidden; box-shadow:0 4px 15px rgba(0,0,0,0.2); }
    video, canvas, img { width:100%; display:block; border-radius:8px; }
    #overlay { position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; }
    #scanner-line { position:absolute; top:0; left:0; width:100%; height:2px; background:rgba(46,139,87,0.8); animation: scan 2s linear infinite; }
    @keyframes scan { 0% { top:0; } 100% { top:100%; } }
    #controls { margin-top:10px; display:flex; gap:5px; flex-wrap:wrap; justify-content:center; }
    #results { margin-top:15px; width:90%; max-width:700px; background:#fff; padding:15px; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.1); white-space:pre-wrap; font-size:14px; line-height:1.5; margin:0 auto; }
    /* Weather */
    .container { max-width: 700px; margin: 0 auto; padding: 1rem; background:#fff; border:1px solid #e6e6e6; border-radius:8px; }
    .muted { color:#555; }
    .footer { text-align:center; color:#333; padding:1.5rem; }
  </style>
</head>
<body>

  <!-- NAV -->
  <nav>
    <a href="#home">Home</a>
    <a href="#crops">Crop Advisory</a>
    <a href="#weather">Weather</a>
    <a href="#krishi">Krishi Bot</a>
    <a href="#contact">Contact</a>
  </nav>

  <!-- HOME -->
  <section id="home">
    <header class="center">
      <h1>üåæ Welcome to PatuKrishi..</h1>
      <p>Ideas and Innovations for Indian Farmers</p>
    </header>
<hr>
    <div class="intro-content" style="margin-top: 2rem;">
      <h2>Welcome to PatuKrishi Pro ‚Äì Your all-in-one farming guide.</h2>
      <p><strong>PatuKrishi</strong> is an innovative agricultural technology solution designed to empower farmers by providing precise and timely information crucial for successful farming. This smart product helps farmers determine the optimal cropping season for specific crops based on their region, ensuring better yields and reduced risks.</p>
      <p>Beyond just cropping advice, PatuKrishi integrates advanced climate forecasting and precipitation prediction, allowing farmers to plan their activities around weather patterns effectively. One of its standout features is the ability to analyze soil fertility simply by capturing a photo, leveraging AI-driven image recognition to give instant, accurate feedback about soil health.</p>
      <p>Complementing these features, PatuKrishi includes an intelligent AI assistant (in the Pro version) that responds to farmers‚Äô questions in real-time, offering expert guidance on a wide range of agricultural topics in regional languages.</p>
      <p>The product is offered in two versions: the standard PatuKrishi with essential features at an affordable price, and PatuKrishi Pro, which includes the full suite of AI capabilities for enhanced support.</p>
      <p>With a three-year guarantee and free technical support, PatuKrishi is committed to making modern agricultural innovations accessible and reliable, ultimately helping farmers increase productivity, reduce uncertainty, and achieve sustainable growth.</p>
      <p><strong>Tagline:</strong> ‚ÄúIdeas and Innovations‚Äù ‚Äî blending technology with traditional farming wisdom to transform rural agriculture.</p>
      <hr/>
      <p><strong>‡§™‡§ü‡•Å‡§ï‡•É‡§∑‡§ø</strong> ‡§è‡§ï ‡§Ö‡§≠‡§ø‡§®‡§µ ‡§ï‡•É‡§∑‡§ø ‡§™‡•ç‡§∞‡•å‡§¶‡•ç‡§Ø‡•ã‡§ó‡§ø‡§ï‡•Ä ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§® ‡§π‡•à ‡§ú‡§ø‡§∏‡•á ‡§∏‡§´‡§≤ ‡§ñ‡•á‡§§‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§∏‡§ü‡•Ä‡§ï ‡§î‡§∞ ‡§∏‡§Æ‡§Ø ‡§™‡§∞ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§∞‡§ï‡•á ‡§ï‡§ø‡§∏‡§æ‡§®‡•ã‡§Ç ‡§ï‡•ã ‡§∏‡§∂‡§ï‡•ç‡§§ ‡§¨‡§®‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§°‡§ø‡§ú‡§º‡§æ‡§á‡§® ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§</p>
      <p>‡§Ø‡§π ‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§ï‡§ø‡§∏‡§æ‡§®‡•ã‡§Ç ‡§ï‡•ã ‡§â‡§®‡§ï‡•á ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ ‡§ï‡•á ‡§Ü‡§ß‡§æ‡§∞ ‡§™‡§∞ ‡§µ‡§ø‡§∂‡§ø‡§∑‡•ç‡§ü ‡§´‡§∏‡§≤‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§á‡§∑‡•ç‡§ü‡§§‡§Æ ‡§´‡§∏‡§≤ ‡§Æ‡•å‡§∏‡§Æ ‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§Æ‡§¶‡§¶ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à, ‡§ú‡§ø‡§∏‡§∏‡•á ‡§¨‡•á‡§π‡§§‡§∞ ‡§™‡•à‡§¶‡§æ‡§µ‡§æ‡§∞ ‡§î‡§∞ ‡§ï‡§Æ ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§∏‡•Å‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§π‡•ã‡§§‡§æ ‡§π‡•à‡•§</p>
      <p>‡§™‡§ü‡•Å‡§ï‡•É‡§∑‡§ø ‡§â‡§®‡•ç‡§®‡§§ ‡§ú‡§≤‡§µ‡§æ‡§Ø‡•Å ‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§®‡•Å‡§Æ‡§æ‡§® ‡§î‡§∞ ‡§µ‡§∞‡•ç‡§∑‡§æ ‡§ï‡•Ä ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø‡§µ‡§æ‡§£‡•Ä ‡§ï‡•ã ‡§è‡§ï‡•Ä‡§ï‡•É‡§§ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à, ‡§ú‡§ø‡§∏‡§∏‡•á ‡§ï‡§ø‡§∏‡§æ‡§® ‡§Æ‡•å‡§∏‡§Æ ‡§ï‡•á ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§Ö‡§™‡§®‡•Ä ‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•Ä ‡§™‡•ç‡§∞‡§≠‡§æ‡§µ‡•Ä ‡§¢‡§Ç‡§ó ‡§∏‡•á ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§¨‡§®‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§</p>
      <p>‡§è‡§ï ‡§™‡•ç‡§∞‡§Æ‡•Å‡§ñ ‡§µ‡§ø‡§∂‡•á‡§∑‡§§‡§æ ‡§ï‡•á‡§µ‡§≤ ‡§è‡§ï ‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞ ‡§ñ‡•Ä‡§Ç‡§ö‡§ï‡§∞ ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§ï‡•Ä ‡§â‡§∞‡•ç‡§µ‡§∞‡§§‡§æ ‡§ï‡§æ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§π‡•à, ‡§ú‡•ã ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§ï‡•á ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§§‡§§‡•ç‡§ï‡§æ‡§≤, ‡§∏‡§ü‡•Ä‡§ï ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§¶‡•á‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§Ü‡§à-‡§∏‡§Ç‡§ö‡§æ‡§≤‡§ø‡§§ ‡§õ‡§µ‡§ø ‡§™‡§π‡§ö‡§æ‡§® ‡§ï‡§æ ‡§≤‡§æ‡§≠ ‡§â‡§†‡§æ‡§§‡•Ä ‡§π‡•à‡•§</p>
      <p>‡§™‡§ü‡•Å‡§ï‡•É‡§∑‡§ø ‡§Æ‡•á‡§Ç ‡§è‡§ï ‡§¨‡•Å‡§¶‡•ç‡§ß‡§ø‡§Æ‡§æ‡§® ‡§è‡§Ü‡§à ‡§∏‡§π‡§æ‡§Ø‡§ï (‡§™‡•ç‡§∞‡•ã ‡§∏‡§Ç‡§∏‡•ç‡§ï‡§∞‡§£ ‡§Æ‡•á‡§Ç) ‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§π‡•à ‡§ú‡•ã ‡§µ‡§æ‡§∏‡•ç‡§§‡§µ‡§ø‡§ï ‡§∏‡§Æ‡§Ø ‡§Æ‡•á‡§Ç ‡§ï‡§ø‡§∏‡§æ‡§®‡•ã‡§Ç ‡§ï‡•á ‡§∏‡§µ‡§æ‡§≤‡•ã‡§Ç ‡§ï‡§æ ‡§ú‡§µ‡§æ‡§¨ ‡§¶‡•á‡§§‡§æ ‡§π‡•à, ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞‡•Ä‡§Ø ‡§≠‡§æ‡§∑‡§æ‡§ì‡§Ç ‡§Æ‡•á‡§Ç ‡§ï‡•É‡§∑‡§ø ‡§µ‡§ø‡§∑‡§Ø‡•ã‡§Ç ‡§™‡§∞ ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û ‡§Æ‡§æ‡§∞‡•ç‡§ó‡§¶‡§∞‡•ç‡§∂‡§® ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§</p>
      <p>‡§Ø‡§π ‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§¶‡•ã ‡§∏‡§Ç‡§∏‡•ç‡§ï‡§∞‡§£‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§π‡•à: ‡§Æ‡§æ‡§®‡§ï ‡§™‡§ü‡•Å‡§ï‡•É‡§∑‡§ø ‡§ú‡§ø‡§∏‡§Æ‡•á‡§Ç ‡§ï‡§ø‡§´‡§æ‡§Ø‡§§‡•Ä ‡§Æ‡•Ç‡§≤‡•ç‡§Ø ‡§™‡§∞ ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§∏‡•Å‡§µ‡§ø‡§ß‡§æ‡§è‡§Å ‡§π‡•à‡§Ç, ‡§î‡§∞ ‡§™‡§ü‡•Å‡§ï‡•É‡§∑‡§ø ‡§™‡•ç‡§∞‡•ã, ‡§ú‡§ø‡§∏‡§Æ‡•á‡§Ç ‡§è‡§Ü‡§à ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§ì‡§Ç ‡§ï‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§∏‡•Ç‡§ü ‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§π‡•à‡•§</p>
      <p>‡§§‡•Ä‡§® ‡§∏‡§æ‡§≤ ‡§ï‡•Ä ‡§ó‡§æ‡§∞‡§Ç‡§ü‡•Ä ‡§î‡§∞ ‡§Æ‡•Å‡§´‡•ç‡§§ ‡§§‡§ï‡§®‡•Ä‡§ï‡•Ä ‡§∏‡§π‡§æ‡§Ø‡§§‡§æ ‡§ï‡•á ‡§∏‡§æ‡§•, ‡§™‡§ü‡•Å‡§ï‡•É‡§∑‡§ø ‡§Ü‡§ß‡•Å‡§®‡§ø‡§ï ‡§ï‡•É‡§∑‡§ø ‡§®‡§µ‡§æ‡§ö‡§æ‡§∞‡•ã‡§Ç ‡§ï‡•ã ‡§∏‡•Å‡§≤‡§≠ ‡§î‡§∞ ‡§µ‡§ø‡§∂‡•ç‡§µ‡§∏‡§®‡•Ä‡§Ø ‡§¨‡§®‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§™‡•ç‡§∞‡§§‡§ø‡§¨‡§¶‡•ç‡§ß ‡§π‡•à‡•§</p>
      <p><strong>‡§ü‡•à‡§ó‡§≤‡§æ‡§á‡§®:</strong> "‡§µ‡§ø‡§ö‡§æ‡§∞ ‡§î‡§∞ ‡§®‡§µ‡§æ‡§ö‡§æ‡§∞" ‚Äî ‡§™‡§æ‡§∞‡§Ç‡§™‡§∞‡§ø‡§ï ‡§ï‡•É‡§∑‡§ø ‡§ú‡•ç‡§û‡§æ‡§® ‡§ï‡•á ‡§∏‡§æ‡§• ‡§§‡§ï‡§®‡•Ä‡§ï ‡§ï‡§æ ‡§Æ‡§ø‡§∂‡•ç‡§∞‡§£ ‡§ï‡§∞ ‡§ó‡•ç‡§∞‡§æ‡§Æ‡•Ä‡§£ ‡§ï‡•É‡§∑‡§ø ‡§ï‡•ã ‡§¨‡§¶‡§≤‡§®‡•á ‡§ï‡§æ ‡§Æ‡§ø‡§∂‡§®‡•§</p>
    </div>
  </section>
<img src="Logo.png" width="05" height="690" </img>
<hr>
  <!-- CROPS -->
  <section id="crops" style="margin-top: 6rem;">
    <h2>üå± Crop Advisory</h2>
    <h3>Find detailed guidance on crop selection<br/>Select Your State and Crop Season:</h3>
    <div class="center">
      <select id="stateSelect" onchange="updateCropInfoBySeason()">
        <option value="">-- Select State --</option>
        <option value="Andhra Pradesh">Andhra Pradesh</option>
        <option value="Arunachal Pradesh">Arunachal Pradesh</option>
        <option value="Assam">Assam</option>
        <option value="Bihar">Bihar</option>
        <option value="Chhattisgarh">Chhattisgarh</option>
        <option value="Goa">Goa</option>
        <option value="Gujarat">Gujarat</option>
        <option value="Haryana">Haryana</option>
        <option value="Himachal Pradesh">Himachal Pradesh</option>
        <option value="Jharkhand">Jharkhand</option>
        <option value="Karnataka">Karnataka</option>
        <option value="Kerala">Kerala</option>
        <option value="Madhya Pradesh">Madhya Pradesh</option>
        <option value="Maharashtra">Maharashtra</option>
        <option value="Manipur">Manipur</option>
        <option value="Meghalaya">Meghalaya</option>
        <option value="Mizoram">Mizoram</option>
        <option value="Nagaland">Nagaland</option>
        <option value="Odisha">Odisha</option>
        <option value="Punjab">Punjab</option>
        <option value="Rajasthan">Rajasthan</option>
        <option value="Sikkim">Sikkim</option>
        <option value="Tamil Nadu">Tamil Nadu</option>
        <option value="Telangana">Telangana</option>
        <option value="Tripura">Tripura</option>
        <option value="Uttar Pradesh">Uttar Pradesh</option>
        <option value="Uttarakhand">Uttarakhand</option>
        <option value="West Bengal">West Bengal</option>
      </select>

      <select id="seasonSelect" onchange="updateCropInfoBySeason()" style="margin-left:1rem;">
        <option value="">-- Select Season --</option>
        <option value="Rabi">Rabi</option>
        <option value="Kharif">Kharif</option>
        <option value="Zaid">Zaid</option>
      </select>
    </div>

    <div id="cropOutput" style="margin-top:1rem;"></div>
  </section>

  <!-- SOIL FERTILITY (Mock) -->
  <section id="fertility">
    <h2>üß™ Soil Fertility Check (Photo-Based Simulation)</h2>
    <p>Select a photo of your soil to get a mock fertility estimate.</p>
    <input accept="image/*" id="soilPhotoInput" type="file"/>
    <div id="preview" style="margin-top:1rem;"></div>
    <button onclick="mockFertilityResult()" style="margin-top:1rem;">Check Fertility</button>
    <p id="fertilityResult" style="font-weight:bold; margin-top:1rem;"></p>
  </section>

  <!-- WEATHER -->
  <section id="weather" style="margin-top: 6rem;">
    <h2>üå¶Ô∏è India Weather Finder</h2>
    <div class="container">
      <input type="text" id="cityInput" placeholder="Enter city or village">
      <br/>
      <button onclick="getWeatherByCity()">Search</button>
      <button onclick="getWeatherByLocation()">üìç Use My Location</button>
      <div id="result" style="margin-top:10px;"></div>
      <p class="muted">Powered by OpenWeather (demo key). Replace with your own API key for production.</p>
    </div>
  </section>

  <!-- KRISHI BOT -->
  <section id="krishi" style="margin-top: 6rem;">
    <h1>üåæ Krishi Bot ü§ñ</h1>

    <div id="languageSelect" class="center">
      <label>Select Language:</label>
      <select id="language">
        <option value="en">English</option>
        <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
        <option value="roman">Hindi (Romanized)</option>
      </select>
      <button onclick="startRecognition()">üé§ Mic</button>
    </div>

    <div id="chatbox"></div>

    <!-- 4 quick-action points in the chatbot -->
    <div class="quick-grid">
      <button onclick="quickAsk('what is agriculture')">What is Agriculture?</button>
      <button onclick="quickAsk('government schemes for farmers')">Govt Schemes</button>
      <button onclick="quickAsk('animals')">Farm Animals</button>
      <button onclick="quickAsk('water management')">Water Management</button>
    </div>

    <div id="chatControls">
      <input type="text" id="userInput" placeholder="Type your message..." />
      <button onclick="sendMessage()">Send</button>
      <button id="lensBtn" title="Open Lens Mode">üîç Lens</button>
    </div>

    <div id="lensContainer"></div>
  </section>

  <!-- CONTACT -->
  <section id="contact" style="margin-top: 6rem;">
    <h2>Contact</h2>
    <header>
      <h1>üìû Contact Us</h1>
    </header>
    <div style="margin-top: 1rem;">
      <p><strong>Phone:</strong> +91 98*** *****</p>
      <p><strong>Email:</strong> chanakyasahni8@gmail.com</p>
    </div>
  </section>

  <div class="footer">This Website is owned by Team ‚Äî The Synergistic Trio</div>

  <!-- Tesseract (for Lens OCR) -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@v4.0.2/dist/tesseract.min.js"></script>

  <script>
    /* =================== Soil Fertility (mock) =================== */
    function previewSoilImage() {
      const input = document.getElementById("soilPhotoInput");
      const preview = document.getElementById("preview");
      preview.innerHTML = "";
      if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const img = document.createElement("img");
          img.src = e.target.result;
          img.style.maxWidth = "300px";
          img.style.marginTop = "1rem";
          img.alt = "Soil preview";
          preview.appendChild(img);
        };
        reader.readAsDataURL(input.files[0]);
      }
    }
    document.getElementById("soilPhotoInput").addEventListener("change", previewSoilImage);

    function mockFertilityResult() {
      const options = ["High", "Medium", "Low"];
      const result = options[Math.floor(Math.random() * options.length)];
      document.getElementById("fertilityResult").innerText = "Fertility Estimate: " + result;
    }

    /* =================== Weather =================== */
    const apiKey = "7ab4aad915c97e3f0a93de8e8d570956"; // demo key

    async function getWeatherByCity() {
      const city = document.getElementById("cityInput").value.trim();
      if (!city) {
        document.getElementById("result").innerHTML = "‚ö†Ô∏è Please enter a place name!";
        return;
      }
      try {
        const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(city)},IN&appid=${apiKey}&units=metric`);
        const data = await response.json();

        if (data.cod !== 200) {
          document.getElementById("result").innerHTML = `‚ö†Ô∏è "${city}" not found, fetching nearest location...`;

          const geoRes = await fetch(`https://api.openweathermap.org/geo/1.0/direct?q=${encodeURIComponent(city)},IN&limit=1&appid=${apiKey}`);
          const geoData = await geoRes.json();

          if (Array.isArray(geoData) && geoData.length > 0) {
            const lat = geoData[0].lat;
            const lon = geoData[0].lon;

            const nearestWeather = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric`);
            const nearestData = await nearestWeather.json();
            showWeather(nearestData, `Nearest location: ${nearestData.name}`);
          } else {
            document.getElementById("result").innerHTML = "‚ùå Location not available, try GPS button.";
          }
        } else {
          showWeather(data, `Exact match: ${data.name}`);
        }
      } catch (error) {
        document.getElementById("result").innerHTML = "‚ö†Ô∏è Network / API error. Check console.";
        console.error("Weather API error:", error);
      }
    }

    function getWeatherByLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(async position => {
          const lat = position.coords.latitude;
          const lon = position.coords.longitude;

          try {
            const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric`);
            const data = await response.json();

            if (data.cod !== 200) {
              document.getElementById("result").innerHTML = `‚ùå Error: ${data.message}`;
            } else {
              showWeather(data, "Your GPS location");
            }
          } catch (error) {
            document.getElementById("result").innerHTML = "‚ö†Ô∏è Network / API error. Check console.";
            console.error("Weather API error:", error);
          }
        }, () => {
          document.getElementById("result").innerHTML = "‚ö†Ô∏è Location access denied.";
        });
      } else {
        document.getElementById("result").innerHTML = "‚ö†Ô∏è Geolocation not supported.";
      }
    }

    function showWeather(data, source = "Location") {
      document.getElementById("result").innerHTML = `
        <b>üìç ${source}:</b> ${data.name} <br>
        üå°Ô∏è Temperature: ${data.main.temp} ¬∞C <br>
        ‚òÅÔ∏è Condition: ${data.weather && data.weather[0] ? data.weather[0].description : "N/A"} <br>
        üíß Humidity: ${data.main.humidity}% <br>
        üå¨Ô∏è Wind Speed: ${data.wind.speed} m/s
      `;
    }

    /* =================== Crop Advisory Data =================== */
    const cropData = {
      "Punjab": { "Rabi": "Wheat, Mustard, Barley", "Kharif": "Paddy, Cotton, Maize", "Zaid": "Moong, Watermelon, Cucumber" },
      "Rajasthan": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Bajra, Jowar, Moong", "Zaid": "Watermelon, Pumpkin, Cucumber" },
      "Maharashtra": { "Rabi": "Wheat, Chickpea, Safflower", "Kharif": "Cotton, Soybean, Tur", "Zaid": "Groundnut, Vegetables, Sunflower" },
      "Tamil Nadu": { "Rabi": "Maize, Sorghum, Pulses", "Kharif": "Rice, Sugarcane, Cotton", "Zaid": "Vegetables, Fruits, Green Gram" },
      "Uttar Pradesh": { "Rabi": "Wheat, Barley, Peas", "Kharif": "Rice, Maize, Arhar", "Zaid": "Cucumber, Moong, Pumpkin" },
      "West Bengal": { "Rabi": "Wheat, Mustard, Lentil", "Kharif": "Rice, Jute, Maize", "Zaid": "Green Gram, Vegetables, Fruits" },
      "Andhra Pradesh": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Arunachal Pradesh": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Assam": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Bihar": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Chhattisgarh": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Goa": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Gujarat": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Haryana": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Himachal Pradesh": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Jharkhand": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Karnataka": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Kerala": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Madhya Pradesh": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Manipur": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Meghalaya": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Mizoram": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Nagaland": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Odisha": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Sikkim": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Telangana": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Tripura": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" },
      "Uttarakhand": { "Rabi": "Wheat, Mustard, Gram", "Kharif": "Rice, Maize, Bajra", "Zaid": "Cucumber, Watermelon, Moong" }
    };

    function updateCropInfoBySeason() {
      const state = document.getElementById('stateSelect').value;
      const season = document.getElementById('seasonSelect').value;
      if (state && season && cropData[state] && cropData[state][season]) {
        const crops = cropData[state][season];
        document.getElementById('cropOutput').innerHTML =
          `<p><strong>${season} Crops in ${state}:</strong> ${crops}</p>`;
      } else if (state || season) {
        document.getElementById('cropOutput').innerHTML =
          `<p><em>No data available for the selected combination.</em></p>`;
      } else {
        document.getElementById('cropOutput').innerHTML = ``;
      }
    }

    /* =================== Krishi Bot =================== */
    const chatbox = document.getElementById("chatbox");
    const userInput = document.getElementById("userInput");
    const languageSelect = document.getElementById("language");
    const lensBtn = document.getElementById("lensBtn");
    const lensContainer = document.getElementById("lensContainer");

    function appendMessage(sender, message) {
      const msg = document.createElement("div");
      msg.textContent = `${sender}: ${message}`;
      chatbox.appendChild(msg);
      chatbox.scrollTop = chatbox.scrollHeight;
    }
    function speak(message, lang) {
      const utterance = new SpeechSynthesisUtterance(message);
      utterance.lang = lang === "hi" ? "hi-IN" : "en-US";
      speechSynthesis.speak(utterance);
    }

    function quickAsk(text) {
      userInput.value = text;
      sendMessage();
    }

    const responses = {
      "hello":{en:"Hello! How are you doing?",hi:"‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§Ü‡§™ ‡§ï‡•à‡§∏‡•á ‡§π‡•à‡§Ç?",roman:"Namaste! Aap kaise hain?"},
      "hi":{en:"Hello! How are you doing?",hi:"‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§Ü‡§™ ‡§ï‡•à‡§∏‡•á ‡§π‡•à‡§Ç?",roman:"Namaste! Aap kaise hain?"},
      "bye":{en:"Bye-bye! Hope to see you soon!",hi:"‡§Ö‡§≤‡§µ‡§ø‡§¶‡§æ! ‡§´‡§ø‡§∞ ‡§Æ‡§ø‡§≤‡•á‡§Ç‡§ó‡•á!",roman:"Alvida! Phir milenge!"},
      "thanks":{en:"Always here to help!",hi:"‡§π‡§Æ‡•á‡§∂‡§æ ‡§∏‡•á‡§µ‡§æ ‡§Æ‡•á‡§Ç!",roman:"Hamesha seva mein!"},
      "sorry":{en:"No problem!",hi:"‡§ï‡•ã‡§à ‡§¨‡§æ‡§§ ‡§®‡§π‡•Ä‡§Ç!",roman:"Koi baat nahi!"},
      "fine":{en:"That's great to know!",hi:"‡§Ø‡§π ‡§∏‡•Å‡§®‡§ï‡§∞ ‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§≤‡§ó‡§æ‡•§",roman:"Yeh sunkar accha laga."},
      "how are you":{en:"I am just a bot, but thank you!",hi:"‡§Æ‡•à‡§Ç ‡§§‡•ã ‡§¨‡§∏ ‡§è‡§ï ‡§¨‡•â‡§ü ‡§π‡•Ç‡§Å, ‡§≤‡•á‡§ï‡§ø‡§® ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶!",roman:"Main to bas ek bot hoon, lekin dhanyavaad!"},
      "what is your name":{en:"My name is Krishi Bot!",hi:"‡§Æ‡•á‡§∞‡§æ ‡§®‡§æ‡§Æ ‡§ï‡•É‡§∑‡•Ä ‡§¨‡•â‡§ü ‡§π‡•à!",roman:"Mera naam Krishi Bot hai!"},
      "aapka naam kya hai":{en:"My name is Krishi Bot!",hi:"‡§Æ‡•á‡§∞‡§æ ‡§®‡§æ‡§Æ ‡§ï‡•É‡§∑‡•Ä ‡§¨‡•â‡§ü ‡§π‡•à!",roman:"Mera naam Krishi Bot hai!"},
      "what is agriculture":{en:"Agriculture is the science of growing crops and raising animals.",hi:"‡§ï‡•É‡§∑‡§ø ‡§´‡§∏‡§≤‡•ã‡§Ç ‡§ï‡•Ä ‡§ñ‡•á‡§§‡•Ä ‡§î‡§∞ ‡§™‡§∂‡•Å‡§™‡§æ‡§≤‡§® ‡§ï‡§æ ‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§® ‡§π‡•à‡•§",roman:"Krishi faslon ki kheti aur pashupalan ka vigyan hai."},
      "krishi kya hai":{en:"Agriculture is the science of growing crops and raising animals.",hi:"‡§ï‡•É‡§∑‡§ø ‡§´‡§∏‡§≤‡•ã‡§Ç ‡§ï‡•Ä ‡§ñ‡•á‡§§‡•Ä ‡§î‡§∞ ‡§™‡§∂‡•Å‡§™‡§æ‡§≤‡§® ‡§ï‡§æ ‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§® ‡§π‡•à‡•§",roman:"Krishi faslon ki kheti aur pashupalan ka vigyan hai."},
      "how to grow more from a piece of land":{
        en:"How to Grow More:\n- Intercropping\n- Crop Rotation\n- HYV Seeds\n- Organic Fertilizer\n- Drip Irrigation\n- Double Cropping\n- Greenhouse Farming\n- Weed Control",
        hi:"‡§è‡§ï ‡§π‡•Ä ‡§ú‡§º‡§Æ‡•Ä‡§® ‡§™‡§∞ ‡§ú‡•ç‡§Ø‡§æ‡§¶‡§æ ‡§´‡§∏‡§≤ ‡§ï‡•à‡§∏‡•á ‡§â‡§ó‡§æ‡§è‡§Ç:\n- ‡§Æ‡§ø‡§∂‡•ç‡§∞ ‡§´‡§∏‡§≤ (Intercropping)\n- ‡§´‡§∏‡§≤ ‡§ö‡§ï‡•ç‡§∞ (Crop Rotation)\n- ‡§â‡§ö‡•ç‡§ö ‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§ï ‡§¨‡•Ä‡§ú\n- ‡§ú‡•à‡§µ‡§ø‡§ï ‡§ñ‡§æ‡§¶\n- ‡§°‡•ç‡§∞‡§ø‡§™ ‡§∏‡§ø‡§Ç‡§ö‡§æ‡§à\n- ‡§¶‡•ã‡§π‡§∞‡•Ä ‡§´‡§∏‡§≤\n- ‡§ó‡•ç‡§∞‡•Ä‡§®‡§π‡§æ‡§â‡§∏ ‡§ñ‡•á‡§§‡•Ä\n- ‡§®‡§ø‡§∞‡§æ‡§à-‡§ó‡•Å‡§°‡§º‡§æ‡§à",
        roman:"Ek hi zameen par zyada fasal kaise ugaayein:\n- Mishrit fasal\n- Fasal chakra\n- Uchh utpadak beej\n- Jaivik khaad\n- Drip sinchaai\n- Dohri fasal\n- Greenhouse kheti\n- Niraai-gudaai"
      },
      "types of soil":{
        en:"Types of Soil in India:\n1. Alluvial Soil\n2. Black Soil\n3. Red Soil\n4. Laterite Soil\n5. Desert Soil\n6. Mountain Soil",
        hi:"‡§≠‡§æ‡§∞‡§§ ‡§Æ‡•á‡§Ç ‡§Æ‡•É‡§¶‡§æ ‡§ï‡•á ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞:\n1. ‡§ú‡§≤‡•ã‡§¢‡§º ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä\n2. ‡§ï‡§æ‡§≤‡•Ä ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä\n3. ‡§≤‡§æ‡§≤ ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä\n4. ‡§≤‡•á‡§ü‡§∞‡§æ‡§á‡§ü ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä\n5. ‡§Æ‡§∞‡•Å‡§∏‡•ç‡§•‡§≤‡•Ä‡§Ø ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä\n6. ‡§™‡§∞‡•ç‡§µ‡§§‡•Ä‡§Ø ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä",
        roman:"Bharat mein mrida ke prakar:\n1. Jalod mitti\n2. Kali mitti\n3. Laal mitti\n4. Laterite mitti\n5. Marusthal mitti\n6. Parvatiya mitti"
      },
      "government schemes for farmers":{
        en:"Major Schemes:\n- PM-KISAN: ‚Çπ6000 yearly\n- PMFBY: Crop Insurance\n- KCC: Loan facility\n- eNAM: Online crop market\n- Soil Health Card\n- National Mission on Sustainable Agriculture",
        hi:"‡§ï‡§ø‡§∏‡§æ‡§®‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç:\n- ‡§™‡•Ä‡§è‡§Æ ‡§ï‡§ø‡§∏‡§æ‡§®: ‚Çπ6000 ‡§∏‡§æ‡§≤‡§æ‡§®‡§æ\n- ‡§™‡•Ä‡§è‡§Æ ‡§´‡§∏‡§≤ ‡§¨‡•Ä‡§Æ‡§æ ‡§Ø‡•ã‡§ú‡§®‡§æ: ‡§¨‡•Ä‡§Æ‡§æ\n- ‡§ï‡§ø‡§∏‡§æ‡§® ‡§ï‡•ç‡§∞‡•á‡§°‡§ø‡§ü ‡§ï‡§æ‡§∞‡•ç‡§°: ‡§ã‡§£ ‡§∏‡•Å‡§µ‡§ø‡§ß‡§æ\n- ‡§à-‡§®‡§æ‡§Æ: ‡§ë‡§®‡§≤‡§æ‡§á‡§® ‡§Æ‡§Ç‡§°‡•Ä\n- ‡§Æ‡•É‡§¶‡§æ ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§ï‡§æ‡§∞‡•ç‡§°\n- ‡§ü‡§ø‡§ï‡§æ‡§ä ‡§ï‡•É‡§∑‡§ø ‡§Æ‡§ø‡§∂‡§®",
        roman:"Kisano ke liye yojanaayein:\n- PM Kisan: ‚Çπ6000 saalana\n- PM Fasal Beema Yojana: Beema\n- Kisan Credit Card: Rin suvidha\n- eNAM: Online mandi\n- Mrida Swasthya Card\n- Tikaau Krishi Mission"
      },
      "prime minister of india":{en:"Prime Minister of India (2025) is Narendra Modi.",hi:"‡§≠‡§æ‡§∞‡§§ ‡§ï‡•á ‡§™‡•ç‡§∞‡§ß‡§æ‡§®‡§Æ‡§Ç‡§§‡•ç‡§∞‡•Ä (2025) ‡§®‡§∞‡•á‡§Ç‡§¶‡•ç‡§∞ ‡§Æ‡•ã‡§¶‡•Ä ‡§π‡•à‡§Ç‡•§",roman:"Bharat ke Pradhan Mantri (2025) Narendra Modi hain."},
      "president of india":{en:"President of India (2025) is Droupadi Murmu.",hi:"‡§≠‡§æ‡§∞‡§§ ‡§ï‡•Ä ‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞‡§™‡§§‡§ø (2025) ‡§¶‡•ç‡§∞‡•å‡§™‡§¶‡•Ä ‡§Æ‡•Å‡§∞‡•ç‡§Æ‡•Ç ‡§π‡•à‡§Ç‡•§",roman:"Bharat ki Rashtrapati (2025) Droupadi Murmu hain."},
      "animals":{en:"Farm animals include cows, buffaloes, goats, sheep, chickens, and pigs. Dairy, meat, and wool are their products.",hi:"‡§ï‡•É‡§∑‡§ø ‡§™‡§∂‡•Å ‡§Æ‡•á‡§Ç ‡§ó‡§æ‡§Ø, ‡§≠‡•à‡§Ç‡§∏, ‡§¨‡§ï‡§∞‡•Ä, ‡§≠‡•á‡§°‡§º, ‡§Æ‡•Å‡§∞‡•ç‡§ó‡•Ä ‡§î‡§∞ ‡§∏‡•Ç‡§Ö‡§∞ ‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§π‡•à‡§Ç‡•§ ‡§á‡§®‡§∏‡•á ‡§¶‡•Ç‡§ß, ‡§Æ‡§æ‡§Ç‡§∏ ‡§î‡§∞ ‡§ä‡§® ‡§Æ‡§ø‡§≤‡§§‡§æ ‡§π‡•à‡•§",roman:"Krishi pashu mein gaay, bhains, bakri, bhed, murgi aur suar shamil hain. Inse doodh, maans aur oon milta hai."},
      "animal feed":{en:"Common animal feeds: grass, hay, grains, silage, and concentrated feed.",hi:"‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§™‡§∂‡•Å ‡§Ü‡§π‡§æ‡§∞: ‡§ò‡§æ‡§∏, ‡§≠‡•Ç‡§∏‡§æ, ‡§Ö‡§®‡§æ‡§ú, ‡§∏‡§ø‡§≤‡•á‡§ú ‡§î‡§∞ ‡§ï‡§Ç‡§∏‡§Ç‡§ü‡•ç‡§∞‡•á‡§ü‡•á‡§° ‡§´‡§º‡•Ä‡§°‡•§",roman:"Saamanya pashu aahaar: ghaas, bhusa, anaaj, silage aur concentrated feed."},
      "water management":{en:"Tips:\n- Rainwater harvesting\n- Drip irrigation\n- Mulching\n- Traditional water systems\n- Groundwater recharge",hi:"‡§ü‡§ø‡§™‡•ç‡§∏:\n- ‡§µ‡§∞‡•ç‡§∑‡§æ ‡§ú‡§≤ ‡§∏‡§Ç‡§ö‡§Ø‡§®\n- ‡§°‡•ç‡§∞‡§ø‡§™ ‡§∏‡§ø‡§Ç‡§ö‡§æ‡§à\n- ‡§Æ‡§≤‡•ç‡§ö‡§ø‡§Ç‡§ó\n- ‡§™‡§æ‡§∞‡§Ç‡§™‡§∞‡§ø‡§ï ‡§ú‡§≤ ‡§™‡•ç‡§∞‡§£‡§æ‡§≤‡•Ä\n- ‡§≠‡•Ç‡§ú‡§≤ ‡§™‡•Å‡§®‡§∞‡•ç‡§≠‡§∞‡§£",roman:"Tips:\n- Varsha jal sanchayan\n- Drip sinchaai\n- Mulching\n- Paaramparik jal pranali\n- Bhoojal punarbharn"}
    };

    // CM Data for 28 states
    const stateData = [
      {state:"Andhra Pradesh",capital:"Amaravati",cm:"N. Chandrababu Naidu"},
      {state:"Arunachal Pradesh",capital:"Itanagar",cm:"Pema Khandu"},
      {state:"Assam",capital:"Dispur",cm:"Himanta Biswa Sarma"},
      {state:"Bihar",capital:"Patna",cm:"Nitish Kumar"},
      {state:"Chhattisgarh",capital:"Raipur",cm:"Vishnu Deo Sai"},
      {state:"Goa",capital:"Panaji",cm:"Pramod Sawant"},
      {state:"Gujarat",capital:"Gandhinagar",cm:"Bhupendra Patel"},
      {state:"Haryana",capital:"Chandigarh",cm:"Nayab Singh Saini"},
      {state:"Himachal Pradesh",capital:"Shimla",cm:"Sukhvinder Singh Sukhu"},
      {state:"Jharkhand",capital:"Ranchi",cm:"Hemant Soren"},
      {state:"Karnataka",capital:"Bengaluru",cm:"Siddaramaiah"},
      {state:"Kerala",capital:"Thiruvananthapuram",cm:"Pinarayi Vijayan"},
      {state:"Madhya Pradesh",capital:"Bhopal",cm:"Mohan Yadav"},
      {state:"Maharashtra",capital:"Mumbai",cm:"Devendra Fadnavis"},
      {state:"Manipur",capital:"Imphal",cm:"N. Biren Singh"},
      {state:"Meghalaya",capital:"Shillong",cm:"Conrad Sangma"},
      {state:"Mizoram",capital:"Aizawl",cm:"Lalduhoma"},
      {state:"Nagaland",capital:"Kohima",cm:"Neiphiu Rio"},
      {state:"Odisha",capital:"Bhubaneswar",cm:"Mohan Charan Majhi"},
      {state:"Punjab",capital:"Chandigarh",cm:"Bhagwant Mann"},
      {state:"Rajasthan",capital:"Jaipur",cm:"Bhajan Lal Sharma"},
      {state:"Sikkim",capital:"Gangtok",cm:"Prem Singh Tamang"},
      {state:"Tamil Nadu",capital:"Chennai",cm:"M. K. Stalin"},
      {state:"Telangana",capital:"Hyderabad",cm:"Revanth Reddy"},
      {state:"Tripura",capital:"Agartala",cm:"Manik Saha"},
      {state:"Uttar Pradesh",capital:"Lucknow",cm:"Yogi Adityanath"},
      {state:"Uttarakhand",capital:"Dehradun",cm:"Pushkar Singh Dhami"},
      {state:"West Bengal",capital:"Kolkata",cm:"Mamata Banerjee"}
    ];

    for (const s of stateData) {
      responses[`cm of ${s.state.toLowerCase()}`] = {
        en: `${s.state}'s Chief Minister is ${s.cm}. Capital is ${s.capital}.`,
        hi: `${s.state} ‡§ï‡•á ‡§Æ‡•Å‡§ñ‡•ç‡§Ø‡§Æ‡§Ç‡§§‡•ç‡§∞‡•Ä ${s.cm} ‡§π‡•à‡§Ç‡•§ ‡§∞‡§æ‡§ú‡§ß‡§æ‡§®‡•Ä ${s.capital} ‡§π‡•à‡•§`,
        roman: `${s.state} ke mukhyamantri ${s.cm} hain. Rajdhani ${s.capital} hai.`
      };
    }

    function sendMessage() {
      const message = userInput.value.trim().toLowerCase();
      if (!message) return;
      const lang = languageSelect.value;
      appendMessage("You", userInput.value);
      userInput.value = "";
      let reply = "Sorry, I didn‚Äôt understand that.";
      for (const key in responses) {
        if (message.includes(key)) {
          reply = responses[key][lang] || responses[key]["en"];
          break;
        }
      }
      appendMessage("Krishi Bot", reply);
      speak(reply, lang);
    }
    userInput.addEventListener("keypress", function(e) { if (e.key === "Enter") sendMessage(); });

    function startRecognition() {
      const lang = languageSelect.value === "hi" ? "hi-IN" : "en-US";
      const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.lang = lang;
      recognition.start();
      recognition.onresult = function(event) {
        const transcript = event.results[0][0].transcript;
        userInput.value = transcript;
        sendMessage();
      };
    }

    /* =================== Lens Mode =================== */
    lensBtn.addEventListener("click", () => {
      document.getElementById("chatbox").style.display = "none";
      userInput.style.display = "none";
      document.querySelector("button[onclick='sendMessage()']").style.display = "none";
      lensBtn.style.display = "none";
      lensContainer.style.display = "block";
      lensContainer.innerHTML = `
        <h2>PatuKrishi Lens Mode</h2>
        <div id="camera-container">
          <video id="video" autoplay playsinline></video>
          <canvas id="overlay"></canvas>
          <img id="uploadedImage" style="display:none;" alt="Uploaded preview">
          <div id="scanner-line"></div>
        </div>
        <div id="controls">
          <input type="file" id="imageInput" accept="image/*">
          <button onclick="useUploadedImage()">Use Uploaded Image</button>
          <button onclick="captureImage()">Capture</button>
          <select id="langSelect">
            <option value="hi">Hindi</option>
            <option value="bn">Bengali</option>
            <option value="te">Telugu</option>
            <option value="mr">Marathi</option>
            <option value="ta">Tamil</option>
            <option value="ur">Urdu</option>
            <option value="gu">Gujarati</option>
            <option value="kn">Kannada</option>
            <option value="ml">Malayalam</option>
            <option value="or">Odia</option>
            <option value="pa">Punjabi</option>
            <option value="as">Assamese</option>
            <option value="ma">Maithili</option>
            <option value="sa">Sanskrit</option>
            <option value="fr">French</option>
            <option value="de">German</option>
            <option value="zh-CN">Chinese</option>
            <option value="ar">Arabic</option>
            <option value="es">Spanish</option>
            <option value="ko">Korean</option>
          </select>
          <button onclick="translateText()">Translate</button>
          <button onclick="simplifyText()">Simplify Text</button>
        </div>
        <div id="results">Status: Waiting for image or camera...</div>
      `;

      const video = document.getElementById('video');
      const canvas = document.getElementById('overlay');
      const ctx = canvas.getContext('2d');
      const uploadedImage = document.getElementById('uploadedImage');
      let capturedImage = null;
      let extractedText = "";

      navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
        .then(stream => { video.srcObject = stream; })
        .catch(err => {
          console.log("Camera not available: " + err);
          video.style.display = "none";
          alert("Camera not available. You can upload an image instead.");
        });

      window.captureImage = function() {
        if (video.style.display === "none") { alert("Camera not available"); return; }
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        capturedImage = canvas.toDataURL('image/png');
        extractedText = "";
        document.getElementById('results').innerHTML = "Processing OCR...";
        runOCR(capturedImage);
      };

      window.useUploadedImage = function() {
        const file = document.getElementById('imageInput').files[0];
        if (!file) { alert("Select an image first"); return; }
        uploadedImage.src = URL.createObjectURL(file);
        uploadedImage.style.display = "block";
        video.style.display = "none";
        uploadedImage.onload = function() {
          canvas.width = uploadedImage.width;
          canvas.height = uploadedImage.height;
          ctx.drawImage(uploadedImage, 0, 0, uploadedImage.width, uploadedImage.height);
          capturedImage = canvas.toDataURL('image/png');
          extractedText = "";
          document.getElementById('results').innerHTML = "Processing OCR...";
          runOCR(capturedImage);
        };
      };

      window.runOCR = function(dataURL) {
        Tesseract.recognize(
          dataURL,
          'eng',
          { logger: m => { if (m.progress !== undefined) document.getElementById('results').innerHTML = 'OCR Progress: ' + (m.progress * 100).toFixed(0) + '%'; } }
        ).then(({ data: { text } }) => {
          extractedText = (text || "").trim();
          document.getElementById('results').innerHTML = `<b>Extracted Text:</b><br>${extractedText || "(none)"}`;
        }).catch(err => {
          document.getElementById('results').innerHTML = 'OCR Error: ' + err;
        });
      };

      window.translateText = function() {
        if (!extractedText) { alert("Capture or upload image first"); return; }
        const targetLang = document.getElementById('langSelect').value;
        document.getElementById('results').innerHTML += "\nTranslating...";
        fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(extractedText)}&langpair=en|${encodeURIComponent(targetLang)}`)
          .then(res => res.json())
          .then(data => {
            const t = (data && data.responseData && data.responseData.translatedText) ? data.responseData.translatedText : "(translation unavailable)";
            document.getElementById('results').innerHTML += `<br><b>Translation:</b><br>${t}`;
          })
          .catch(err => document.getElementById('results').innerHTML += "<br>Translation Error: " + err);
      };

      window.simplifyText = function() {
        if (!extractedText) { alert("Capture or upload image first"); return; }
        let sentences = extractedText.split(/[\.\?\!]/).map(s => s.trim()).filter(s => s.length > 0);
        let simplified = sentences.join('. ') + (sentences.length ? "." : "");
        document.getElementById('results').innerHTML += `<br><b>Simplified Text:</b><br>${simplified}`;
      };
    });
  </script>
</body>
</html>
